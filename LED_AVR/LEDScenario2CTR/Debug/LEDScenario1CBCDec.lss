
AVRASM ver. 2.1.57  K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm Wed Aug 19 21:39:53 2015

[builtin](2): Including file 'C:\Program Files (x86)\Atmel\Atmel Toolchain\AVR Assembler\Native\2.1.1175\avrassembler\Include\tn45def.inc'
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(1): Including file 'C:\Program Files (x86)\Atmel\Atmel Toolchain\AVR Assembler\Native\2.1.1175\avrassembler\Include\tn45def.inc'
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): Including file 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm'
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(68): warning: Register r16 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(69): warning: Register r17 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(70): warning: Register r18 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(71): warning: Register r19 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(72): warning: Register r20 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(73): warning: Register r21 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(74): warning: Register r22 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(75): warning: Register r23 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(80): warning: Register r24 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(81): warning: Register r25 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(83): warning: Register r26 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(84): warning: Register r27 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(86): warning: .def: 'YL' redefinition (r28->r28)
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(86): warning: Register r28 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(87): warning: .def: 'YH' redefinition (r29->r29)
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(87): warning: Register r29 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(88): warning: .def: 'ZL' redefinition (r30->r30)
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(88): warning: Register r30 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(89): warning: .def: 'ZH' redefinition (r31->r31)
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(89): warning: Register r31 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm(91): warning: Register r0 already defined by the .DEF directive
K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\interface.asm(21): 'K:\Seagate\LED\LED_AVR\LEDScenario1CBCDec\./LEDScenario1CBCDec.asm' included form here
                 
                 .include "tn45def.inc"
                 
                 ;***** Created: 2011-02-09 12:04 ******* Source: ATtiny45.xml ************
                 ;*************************************************************************
                 ;* A P P L I C A T I O N   N O T E   F O R   T H E   A V R   F A M I L Y
                 ;* 
                 ;* Number            : AVR000
                 ;* File Name         : "tn45def.inc"
                 ;* Title             : Register/Bit Definitions for the ATtiny45
                 ;* Date              : 2011-02-09
                 ;* Version           : 2.35
                 ;* Support E-mail    : avr@atmel.com
                 ;* Target MCU        : ATtiny45
                 ;* 
                 ;* DESCRIPTION
                 ;* When including this file in the assembly program file, all I/O register 
                 ;* names and I/O register bit names appearing in the data book can be used.
                 ;* In addition, the six registers forming the three data pointers X, Y and 
                 ;* Z have been assigned names XL - ZH. Highest RAM address for Internal 
                 ;* SRAM is also defined 
                 ;* 
                 ;* The Register names are represented by their hexadecimal address.
                 ;* 
                 ;* The Register Bit names are represented by their bit number (0-7).
                 ;* 
                 ;* Please observe the difference in using the bit names with instructions
                 ;* such as "sbr"/"cbr" (set/clear bit in register) and "sbrs"/"sbrc"
                 ;* (skip if bit in register set/cleared). The following example illustrates
                 ;* this:
                 ;* 
                 ;* in    r16,PORTB             ;read PORTB latch
                 ;* sbr   r16,(1<<PB6)+(1<<PB5) ;set PB6 and PB5 (use masks, not bit#)
                 ;* out   PORTB,r16             ;output to PORTB
                 ;* 
                 ;* in    r16,TIFR              ;read the Timer Interrupt Flag Register
                 ;* sbrc  r16,TOV0              ;test the overflow flag (use bit#)
                 ;* rjmp  TOV0_is_set           ;jump if set
                 ;* ...                         ;otherwise do something else
                 ;*************************************************************************
                 
                 #ifndef _TN45DEF_INC_
                 #define _TN45DEF_INC_
                 
                 
                 #pragma partinc 0
                 
                 ; ***** SPECIFY DEVICE ***************************************************
                 .device ATtiny45
                 #pragma AVRPART ADMIN PART_NAME ATtiny45
                 .equ	SIGNATURE_000	= 0x1e
                 .equ	SIGNATURE_001	= 0x92
                 .equ	SIGNATURE_002	= 0x06
                 
                 #pragma AVRPART CORE CORE_VERSION V2
                 #pragma AVRPART CORE NEW_INSTRUCTIONS lpm rd,z+
                 
                 
                 ; ***** I/O REGISTER DEFINITIONS *****************************************
                 ; NOTE:
                 ; Definitions marked "MEMORY MAPPED"are extended I/O ports
                 ; and cannot be used with IN/OUT instructions
                 .equ	SREG	= 0x3f
                 .equ	SPL	= 0x3d
                 .equ	SPH	= 0x3e
                 .equ	GIMSK	= 0x3b
                 .equ	GIFR	= 0x3a
                 .equ	TIMSK	= 0x39
                 .equ	TIFR	= 0x38
                 .equ	SPMCSR	= 0x37
                 .equ	MCUCR	= 0x35
                 .equ	MCUSR	= 0x34
                 .equ	TCCR0B	= 0x33
                 .equ	TCNT0	= 0x32
                 .equ	OSCCAL	= 0x31
                 .equ	TCCR1	= 0x30
                 .equ	TCNT1	= 0x2f
                 .equ	OCR1A	= 0x2e
                 .equ	OCR1C	= 0x2d
                 .equ	GTCCR	= 0x2c
                 .equ	OCR1B	= 0x2b
                 .equ	TCCR0A	= 0x2a
                 .equ	OCR0A	= 0x29
                 .equ	OCR0B	= 0x28
                 .equ	PLLCSR	= 0x27
                 .equ	CLKPR	= 0x26
                 .equ	DT1A	= 0x25
                 .equ	DT1B	= 0x24
                 .equ	DTPS	= 0x23
                 .equ	DWDR	= 0x22
                 .equ	WDTCR	= 0x21
                 .equ	PRR	= 0x20
                 .equ	EEARH	= 0x1f
                 .equ	EEARL	= 0x1e
                 .equ	EEDR	= 0x1d
                 .equ	EECR	= 0x1c
                 .equ	PORTB	= 0x18
                 .equ	DDRB	= 0x17
                 .equ	PINB	= 0x16
                 .equ	PCMSK	= 0x15
                 .equ	DIDR0	= 0x14
                 .equ	GPIOR2	= 0x13
                 .equ	GPIOR1	= 0x12
                 .equ	GPIOR0	= 0x11
                 .equ	USIBR	= 0x10
                 .equ	USIDR	= 0x0f
                 .equ	USISR	= 0x0e
                 .equ	USICR	= 0x0d
                 .equ	ACSR	= 0x08
                 .equ	ADMUX	= 0x07
                 .equ	ADCSRA	= 0x06
                 .equ	ADCH	= 0x05
                 .equ	ADCL	= 0x04
                 .equ	ADCSRB	= 0x03
                 
                 
                 ; ***** BIT DEFINITIONS **************************************************
                 
                 ; ***** PORTB ************************
                 ; PORTB - Data Register, Port B
                 .equ	PORTB0	= 0	; 
                 .equ	PB0	= 0	; For compatibility
                 .equ	PORTB1	= 1	; 
                 .equ	PB1	= 1	; For compatibility
                 .equ	PORTB2	= 2	; 
                 .equ	PB2	= 2	; For compatibility
                 .equ	PORTB3	= 3	; 
                 .equ	PB3	= 3	; For compatibility
                 .equ	PORTB4	= 4	; 
                 .equ	PB4	= 4	; For compatibility
                 .equ	PORTB5	= 5	; 
                 .equ	PB5	= 5	; For compatibility
                 
                 ; DDRB - Data Direction Register, Port B
                 .equ	DDB0	= 0	; 
                 .equ	DDB1	= 1	; 
                 .equ	DDB2	= 2	; 
                 .equ	DDB3	= 3	; 
                 .equ	DDB4	= 4	; 
                 .equ	DDB5	= 5	; 
                 
                 ; PINB - Input Pins, Port B
                 .equ	PINB0	= 0	; 
                 .equ	PINB1	= 1	; 
                 .equ	PINB2	= 2	; 
                 .equ	PINB3	= 3	; 
                 .equ	PINB4	= 4	; 
                 .equ	PINB5	= 5	; 
                 
                 
                 ; ***** ANALOG_COMPARATOR ************
                 ; ADCSRB - ADC Control and Status Register B
                 .equ	ACME	= 6	; Analog Comparator Multiplexer Enable
                 
                 ; ACSR - Analog Comparator Control And Status Register
                 .equ	ACIS0	= 0	; Analog Comparator Interrupt Mode Select bit 0
                 .equ	ACIS1	= 1	; Analog Comparator Interrupt Mode Select bit 1
                 .equ	ACIE	= 3	; Analog Comparator Interrupt Enable
                 .equ	ACI	= 4	; Analog Comparator Interrupt Flag
                 .equ	ACO	= 5	; Analog Compare Output
                 .equ	ACBG	= 6	; Analog Comparator Bandgap Select
                 .equ	AINBG	= ACBG	; For compatibility
                 .equ	ACD	= 7	; Analog Comparator Disable
                 
                 ; DIDR0 - 
                 .equ	AIN0D	= 0	; AIN0 Digital Input Disable
                 .equ	AIN1D	= 1	; AIN1 Digital Input Disable
                 
                 
                 ; ***** AD_CONVERTER *****************
                 ; ADMUX - The ADC multiplexer Selection Register
                 .equ	MUX0	= 0	; Analog Channel and Gain Selection Bits
                 .equ	MUX1	= 1	; Analog Channel and Gain Selection Bits
                 .equ	MUX2	= 2	; Analog Channel and Gain Selection Bits
                 .equ	MUX3	= 3	; Analog Channel and Gain Selection Bits
                 .equ	REFS2	= 4	; Reference Selection Bit 2
                 .equ	ADLAR	= 5	; Left Adjust Result
                 .equ	REFS0	= 6	; Reference Selection Bit 0
                 .equ	REFS1	= 7	; Reference Selection Bit 1
                 
                 ; ADCSRA - The ADC Control and Status register
                 .equ	ADPS0	= 0	; ADC  Prescaler Select Bits
                 .equ	ADPS1	= 1	; ADC  Prescaler Select Bits
                 .equ	ADPS2	= 2	; ADC  Prescaler Select Bits
                 .equ	ADIE	= 3	; ADC Interrupt Enable
                 .equ	ADIF	= 4	; ADC Interrupt Flag
                 .equ	ADATE	= 5	; ADC Auto Trigger Enable
                 .equ	ADSC	= 6	; ADC Start Conversion
                 .equ	ADEN	= 7	; ADC Enable
                 
                 ; ADCH - ADC Data Register High Byte
                 .equ	ADCH0	= 0	; ADC Data Register High Byte Bit 0
                 .equ	ADCH1	= 1	; ADC Data Register High Byte Bit 1
                 .equ	ADCH2	= 2	; ADC Data Register High Byte Bit 2
                 .equ	ADCH3	= 3	; ADC Data Register High Byte Bit 3
                 .equ	ADCH4	= 4	; ADC Data Register High Byte Bit 4
                 .equ	ADCH5	= 5	; ADC Data Register High Byte Bit 5
                 .equ	ADCH6	= 6	; ADC Data Register High Byte Bit 6
                 .equ	ADCH7	= 7	; ADC Data Register High Byte Bit 7
                 
                 ; ADCL - ADC Data Register Low Byte
                 .equ	ADCL0	= 0	; ADC Data Register Low Byte Bit 0
                 .equ	ADCL1	= 1	; ADC Data Register Low Byte Bit 1
                 .equ	ADCL2	= 2	; ADC Data Register Low Byte Bit 2
                 .equ	ADCL3	= 3	; ADC Data Register Low Byte Bit 3
                 .equ	ADCL4	= 4	; ADC Data Register Low Byte Bit 4
                 .equ	ADCL5	= 5	; ADC Data Register Low Byte Bit 5
                 .equ	ADCL6	= 6	; ADC Data Register Low Byte Bit 6
                 .equ	ADCL7	= 7	; ADC Data Register Low Byte Bit 7
                 
                 ; ADCSRB - ADC Control and Status Register B
                 .equ	ADTS0	= 0	; ADC Auto Trigger Source 0
                 .equ	ADTS1	= 1	; ADC Auto Trigger Source 1
                 .equ	ADTS2	= 2	; ADC Auto Trigger Source 2
                 .equ	IPR	= 5	; Input Polarity Mode
                 .equ	BIN	= 7	; Bipolar Input Mode
                 
                 ; DIDR0 - Digital Input Disable Register 0
                 .equ	ADC1D	= 2	; ADC1 Digital input Disable
                 .equ	ADC3D	= 3	; ADC3 Digital input Disable
                 .equ	ADC2D	= 4	; ADC2 Digital input Disable
                 .equ	ADC0D	= 5	; ADC0 Digital input Disable
                 
                 
                 ; ***** USI **************************
                 ; USIBR - USI Buffer Register
                 .equ	USIBR0	= 0	; USI Buffer Register bit 0
                 .equ	USIBR1	= 1	; USI Buffer Register bit 1
                 .equ	USIBR2	= 2	; USI Buffer Register bit 2
                 .equ	USIBR3	= 3	; USI Buffer Register bit 3
                 .equ	USIBR4	= 4	; USI Buffer Register bit 4
                 .equ	USIBR5	= 5	; USI Buffer Register bit 5
                 .equ	USIBR6	= 6	; USI Buffer Register bit 6
                 .equ	USIBR7	= 7	; USI Buffer Register bit 7
                 
                 ; USIDR - USI Data Register
                 .equ	USIDR0	= 0	; USI Data Register bit 0
                 .equ	USIDR1	= 1	; USI Data Register bit 1
                 .equ	USIDR2	= 2	; USI Data Register bit 2
                 .equ	USIDR3	= 3	; USI Data Register bit 3
                 .equ	USIDR4	= 4	; USI Data Register bit 4
                 .equ	USIDR5	= 5	; USI Data Register bit 5
                 .equ	USIDR6	= 6	; USI Data Register bit 6
                 .equ	USIDR7	= 7	; USI Data Register bit 7
                 
                 ; USISR - USI Status Register
                 .equ	USICNT0	= 0	; USI Counter Value Bit 0
                 .equ	USICNT1	= 1	; USI Counter Value Bit 1
                 .equ	USICNT2	= 2	; USI Counter Value Bit 2
                 .equ	USICNT3	= 3	; USI Counter Value Bit 3
                 .equ	USIDC	= 4	; Data Output Collision
                 .equ	USIPF	= 5	; Stop Condition Flag
                 .equ	USIOIF	= 6	; Counter Overflow Interrupt Flag
                 .equ	USISIF	= 7	; Start Condition Interrupt Flag
                 
                 ; USICR - USI Control Register
                 .equ	USITC	= 0	; Toggle Clock Port Pin
                 .equ	USICLK	= 1	; Clock Strobe
                 .equ	USICS0	= 2	; USI Clock Source Select Bit 0
                 .equ	USICS1	= 3	; USI Clock Source Select Bit 1
                 .equ	USIWM0	= 4	; USI Wire Mode Bit 0
                 .equ	USIWM1	= 5	; USI Wire Mode Bit 1
                 .equ	USIOIE	= 6	; Counter Overflow Interrupt Enable
                 .equ	USISIE	= 7	; Start Condition Interrupt Enable
                 
                 
                 ; ***** EXTERNAL_INTERRUPT ***********
                 ; MCUCR - MCU Control Register
                 .equ	ISC00	= 0	; Interrupt Sense Control 0 Bit 0
                 .equ	ISC01	= 1	; Interrupt Sense Control 0 Bit 1
                 
                 ; GIMSK - General Interrupt Mask Register
                 .equ	GICR	= GIMSK	; For compatibility
                 .equ	PCIE	= 5	; Pin Change Interrupt Enable
                 .equ	INT0	= 6	; External Interrupt Request 0 Enable
                 
                 ; GIFR - General Interrupt Flag register
                 .equ	PCIF	= 5	; Pin Change Interrupt Flag
                 .equ	INTF0	= 6	; External Interrupt Flag 0
                 
                 ; PCMSK - Pin Change Enable Mask
                 .equ	PCINT0	= 0	; Pin Change Enable Mask Bit 0
                 .equ	PCINT1	= 1	; Pin Change Enable Mask Bit 1
                 .equ	PCINT2	= 2	; Pin Change Enable Mask Bit 2
                 .equ	PCINT3	= 3	; Pin Change Enable Mask Bit 3
                 .equ	PCINT4	= 4	; Pin Change Enable Mask Bit 4
                 .equ	PCINT5	= 5	; Pin Change Enable Mask Bit 5
                 
                 
                 ; ***** EEPROM ***********************
                 ; EEARL - EEPROM Address Register Low Byte
                 .equ	EEAR0	= 0	; EEPROM Read/Write Access Bit 0
                 .equ	EEAR1	= 1	; EEPROM Read/Write Access Bit 1
                 .equ	EEAR2	= 2	; EEPROM Read/Write Access Bit 2
                 .equ	EEAR3	= 3	; EEPROM Read/Write Access Bit 3
                 .equ	EEAR4	= 4	; EEPROM Read/Write Access Bit 4
                 .equ	EEAR5	= 5	; EEPROM Read/Write Access Bit 5
                 .equ	EEAR6	= 6	; EEPROM Read/Write Access Bit 6
                 .equ	EEAR7	= 7	; EEPROM Read/Write Access Bit 7
                 
                 ; EEARH - EEPROM Address Register High Byte
                 .equ	EEAR8	= 0	; EEPROM Read/Write Access Bit 0
                 
                 ; EEDR - EEPROM Data Register
                 .equ	EEDR0	= 0	; EEPROM Data Register bit 0
                 .equ	EEDR1	= 1	; EEPROM Data Register bit 1
                 .equ	EEDR2	= 2	; EEPROM Data Register bit 2
                 .equ	EEDR3	= 3	; EEPROM Data Register bit 3
                 .equ	EEDR4	= 4	; EEPROM Data Register bit 4
                 .equ	EEDR5	= 5	; EEPROM Data Register bit 5
                 .equ	EEDR6	= 6	; EEPROM Data Register bit 6
                 .equ	EEDR7	= 7	; EEPROM Data Register bit 7
                 
                 ; EECR - EEPROM Control Register
                 .equ	EERE	= 0	; EEPROM Read Enable
                 .equ	EEPE	= 1	; EEPROM Write Enable
                 .equ	EEMPE	= 2	; EEPROM Master Write Enable
                 .equ	EERIE	= 3	; EEPROM Ready Interrupt Enable
                 .equ	EEPM0	= 4	; EEPROM Programming Mode Bit 0
                 .equ	EEPM1	= 5	; EEPROM Programming Mode Bit 1
                 
                 
                 ; ***** WATCHDOG *********************
                 ; WDTCR - Watchdog Timer Control Register
                 .equ	WDTCSR	= WDTCR	; For compatibility
                 .equ	WDP0	= 0	; Watch Dog Timer Prescaler bit 0
                 .equ	WDP1	= 1	; Watch Dog Timer Prescaler bit 1
                 .equ	WDP2	= 2	; Watch Dog Timer Prescaler bit 2
                 .equ	WDE	= 3	; Watch Dog Enable
                 .equ	WDCE	= 4	; Watchdog Change Enable
                 .equ	WDTOE	= WDCE	; For compatibility
                 .equ	WDP3	= 5	; Watchdog Timer Prescaler Bit 3
                 .equ	WDIE	= 6	; Watchdog Timeout Interrupt Enable
                 .equ	WDIF	= 7	; Watchdog Timeout Interrupt Flag
                 
                 
                 ; ***** TIMER_COUNTER_0 **************
                 ; TIMSK - Timer/Counter Interrupt Mask Register
                 .equ	TOIE0	= 1	; Timer/Counter0 Overflow Interrupt Enable
                 .equ	OCIE0B	= 3	; Timer/Counter0 Output Compare Match B Interrupt Enable
                 .equ	OCIE0A	= 4	; Timer/Counter0 Output Compare Match A Interrupt Enable
                 
                 ; TIFR - Timer/Counter0 Interrupt Flag register
                 .equ	TOV0	= 1	; Timer/Counter0 Overflow Flag
                 .equ	OCF0B	= 3	; Timer/Counter0 Output Compare Flag 0B
                 .equ	OCF0A	= 4	; Timer/Counter0 Output Compare Flag 0A
                 
                 ; TCCR0A - Timer/Counter  Control Register A
                 .equ	WGM00	= 0	; Waveform Generation Mode
                 .equ	WGM01	= 1	; Waveform Generation Mode
                 .equ	COM0B0	= 4	; Compare Output Mode, Fast PWm
                 .equ	COM0B1	= 5	; Compare Output Mode, Fast PWm
                 .equ	COM0A0	= 6	; Compare Output Mode, Phase Correct PWM Mode
                 .equ	COM0A1	= 7	; Compare Output Mode, Phase Correct PWM Mode
                 
                 ; TCCR0B - Timer/Counter Control Register B
                 .equ	CS00	= 0	; Clock Select
                 .equ	CS01	= 1	; Clock Select
                 .equ	CS02	= 2	; Clock Select
                 .equ	WGM02	= 3	; 
                 .equ	FOC0B	= 6	; Force Output Compare B
                 .equ	FOC0A	= 7	; Force Output Compare A
                 
                 ; TCNT0 - Timer/Counter0
                 .equ	TCNT0_0	= 0	; 
                 .equ	TCNT0_1	= 1	; 
                 .equ	TCNT0_2	= 2	; 
                 .equ	TCNT0_3	= 3	; 
                 .equ	TCNT0_4	= 4	; 
                 .equ	TCNT0_5	= 5	; 
                 .equ	TCNT0_6	= 6	; 
                 .equ	TCNT0_7	= 7	; 
                 
                 ; OCR0A - Timer/Counter0 Output Compare Register
                 .equ	OCR0_0	= 0	; 
                 .equ	OCR0_1	= 1	; 
                 .equ	OCR0_2	= 2	; 
                 .equ	OCR0_3	= 3	; 
                 .equ	OCR0_4	= 4	; 
                 .equ	OCR0_5	= 5	; 
                 .equ	OCR0_6	= 6	; 
                 .equ	OCR0_7	= 7	; 
                 
                 ; OCR0B - Timer/Counter0 Output Compare Register
                 ;.equ	OCR0_0	= 0	; 
                 ;.equ	OCR0_1	= 1	; 
                 ;.equ	OCR0_2	= 2	; 
                 ;.equ	OCR0_3	= 3	; 
                 ;.equ	OCR0_4	= 4	; 
                 ;.equ	OCR0_5	= 5	; 
                 ;.equ	OCR0_6	= 6	; 
                 ;.equ	OCR0_7	= 7	; 
                 
                 ; GTCCR - General Timer/Counter Control Register
                 .equ	PSR0	= 0	; Prescaler Reset Timer/Counter1 and Timer/Counter0
                 .equ	TSM	= 7	; Timer/Counter Synchronization Mode
                 
                 
                 ; ***** TIMER_COUNTER_1 **************
                 ; TCCR1 - Timer/Counter Control Register
                 .equ	CS10	= 0	; Clock Select Bits
                 .equ	CS11	= 1	; Clock Select Bits
                 .equ	CS12	= 2	; Clock Select Bits
                 .equ	CS13	= 3	; Clock Select Bits
                 .equ	COM1A0	= 4	; Compare Output Mode, Bit 1
                 .equ	COM1A1	= 5	; Compare Output Mode, Bit 0
                 .equ	PWM1A	= 6	; Pulse Width Modulator Enable
                 .equ	CTC1	= 7	; Clear Timer/Counter on Compare Match
                 
                 ; TCNT1 - Timer/Counter Register
                 .equ	TCNT1_0	= 0	; Timer/Counter Register Bit 0
                 .equ	TCNT1_1	= 1	; Timer/Counter Register Bit 1
                 .equ	TCNT1_2	= 2	; Timer/Counter Register Bit 2
                 .equ	TCNT1_3	= 3	; Timer/Counter Register Bit 3
                 .equ	TCNT1_4	= 4	; Timer/Counter Register Bit 4
                 .equ	TCNT1_5	= 5	; Timer/Counter Register Bit 5
                 .equ	TCNT1_6	= 6	; Timer/Counter Register Bit 6
                 .equ	TCNT1_7	= 7	; Timer/Counter Register Bit 7
                 
                 ; OCR1A - Output Compare Register
                 .equ	OCR1A0	= 0	; Output Compare Register A Bit 0
                 .equ	OCR1A1	= 1	; Output Compare Register A Bit 1
                 .equ	OCR1A2	= 2	; Output Compare Register A Bit 2
                 .equ	OCR1A3	= 3	; Output Compare Register A Bit 3
                 .equ	OCR1A4	= 4	; Output Compare Register A Bit 4
                 .equ	OCR1A5	= 5	; Output Compare Register A Bit 5
                 .equ	OCR1A6	= 6	; Output Compare Register A Bit 6
                 .equ	OCR1A7	= 7	; Output Compare Register A Bit 7
                 
                 ; OCR1B - Output Compare Register
                 .equ	OCR1B0	= 0	; Output Compare Register B Bit 0
                 .equ	OCR1B1	= 1	; Output Compare Register B Bit 1
                 .equ	OCR1B2	= 2	; Output Compare Register B Bit 2
                 .equ	OCR1B3	= 3	; Output Compare Register B Bit 3
                 .equ	OCR1B4	= 4	; Output Compare Register B Bit 4
                 .equ	OCR1B5	= 5	; Output Compare Register B Bit 5
                 .equ	OCR1B6	= 6	; Output Compare Register B Bit 6
                 .equ	OCR1B7	= 7	; Output Compare Register B Bit 7
                 
                 ; OCR1C - Output compare register
                 .equ	OCR1C0	= 0	; 
                 .equ	OCR1C1	= 1	; 
                 .equ	OCR1C2	= 2	; 
                 .equ	OCR1C3	= 3	; 
                 .equ	OCR1C4	= 4	; 
                 .equ	OCR1C5	= 5	; 
                 .equ	OCR1C6	= 6	; 
                 .equ	OCR1C7	= 7	; 
                 
                 ; TIMSK - Timer/Counter Interrupt Mask Register
                 .equ	TOIE1	= 2	; Timer/Counter1 Overflow Interrupt Enable
                 .equ	OCIE1B	= 5	; OCIE1A: Timer/Counter1 Output Compare B Interrupt Enable
                 .equ	OCIE1A	= 6	; OCIE1A: Timer/Counter1 Output Compare Interrupt Enable
                 
                 ; TIFR - Timer/Counter Interrupt Flag Register
                 .equ	TOV1	= 2	; Timer/Counter1 Overflow Flag
                 .equ	OCF1B	= 5	; Timer/Counter1 Output Compare Flag 1B
                 .equ	OCF1A	= 6	; Timer/Counter1 Output Compare Flag 1A
                 
                 ; GTCCR - Timer counter control register
                 .equ	PSR1	= 1	; Prescaler Reset Timer/Counter1
                 .equ	FOC1A	= 2	; Force Output Compare 1A
                 .equ	FOC1B	= 3	; Force Output Compare Match 1B
                 .equ	COM1B0	= 4	; Comparator B Output Mode
                 .equ	COM1B1	= 5	; Comparator B Output Mode
                 .equ	PWM1B	= 6	; Pulse Width Modulator B Enable
                 
                 ; DTPS - Dead time prescaler register
                 .equ	DTPS0	= 0	; 
                 .equ	DTPS1	= 1	; 
                 
                 ; DT1A - Dead time value register
                 .equ	DTVL0	= 0	; 
                 .equ	DTVL1	= 1	; 
                 .equ	DTVL2	= 2	; 
                 .equ	DTVL3	= 3	; 
                 .equ	DTVH0	= 4	; 
                 .equ	DTVH1	= 5	; 
                 .equ	DTVH2	= 6	; 
                 .equ	DTVH3	= 7	; 
                 
                 ; DT1B - Dead time value B
                 ;.equ	DTVL0	= 0	; 
                 ;.equ	DTVL1	= 1	; 
                 ;.equ	DTVL2	= 2	; 
                 ;.equ	DTVL3	= 3	; 
                 ;.equ	DTVH0	= 4	; 
                 ;.equ	DTVH1	= 5	; 
                 ;.equ	DTVH2	= 6	; 
                 ;.equ	DTVH3	= 7	; 
                 
                 
                 ; ***** CPU **************************
                 ; SREG - Status Register
                 .equ	SREG_C	= 0	; Carry Flag
                 .equ	SREG_Z	= 1	; Zero Flag
                 .equ	SREG_N	= 2	; Negative Flag
                 .equ	SREG_V	= 3	; Two's Complement Overflow Flag
                 .equ	SREG_S	= 4	; Sign Bit
                 .equ	SREG_H	= 5	; Half Carry Flag
                 .equ	SREG_T	= 6	; Bit Copy Storage
                 .equ	SREG_I	= 7	; Global Interrupt Enable
                 
                 ; MCUCR - MCU Control Register
                 ;.equ	ISC00	= 0	; Interrupt Sense Control 0 bit 0
                 ;.equ	ISC01	= 1	; Interrupt Sense Control 0 bit 1
                 .equ	BODSE	= 2	; BOD Sleep Enable
                 .equ	SM0	= 3	; Sleep Mode Select Bit 0
                 .equ	SM1	= 4	; Sleep Mode Select Bit 1
                 .equ	SE	= 5	; Sleep Enable
                 .equ	PUD	= 6	; Pull-up Disable
                 .equ	BODS	= 7	; BOD Sleep
                 
                 ; MCUSR - MCU Status register
                 .equ	PORF	= 0	; Power-On Reset Flag
                 .equ	EXTRF	= 1	; External Reset Flag
                 .equ	BORF	= 2	; Brown-out Reset Flag
                 .equ	WDRF	= 3	; Watchdog Reset Flag
                 
                 ; PRR - Power Reduction Register
                 .equ	PRADC	= 0	; Power Reduction ADC
                 .equ	PRUSI	= 1	; Power Reduction USI
                 .equ	PRTIM0	= 2	; Power Reduction Timer/Counter0
                 .equ	PRTIM1	= 3	; Power Reduction Timer/Counter1
                 
                 ; OSCCAL - Oscillator Calibration Register
                 .equ	CAL0	= 0	; Oscillatro Calibration Value Bit 0
                 .equ	CAL1	= 1	; Oscillatro Calibration Value Bit 1
                 .equ	CAL2	= 2	; Oscillatro Calibration Value Bit 2
                 .equ	CAL3	= 3	; Oscillatro Calibration Value Bit 3
                 .equ	CAL4	= 4	; Oscillatro Calibration Value Bit 4
                 .equ	CAL5	= 5	; Oscillatro Calibration Value Bit 5
                 .equ	CAL6	= 6	; Oscillatro Calibration Value Bit 6
                 .equ	CAL7	= 7	; Oscillatro Calibration Value Bit 7
                 
                 ; PLLCSR - PLL Control and status register
                 .equ	PLOCK	= 0	; PLL Lock detector
                 .equ	PLLE	= 1	; PLL Enable
                 .equ	PCKE	= 2	; PCK Enable
                 .equ	LSM	= 7	; Low speed mode
                 
                 ; CLKPR - Clock Prescale Register
                 .equ	CLKPS0	= 0	; Clock Prescaler Select Bit 0
                 .equ	CLKPS1	= 1	; Clock Prescaler Select Bit 1
                 .equ	CLKPS2	= 2	; Clock Prescaler Select Bit 2
                 .equ	CLKPS3	= 3	; Clock Prescaler Select Bit 3
                 .equ	CLKPCE	= 7	; Clock Prescaler Change Enable
                 
                 ; DWDR - debugWire data register
                 .equ	DWDR0	= 0	; 
                 .equ	DWDR1	= 1	; 
                 .equ	DWDR2	= 2	; 
                 .equ	DWDR3	= 3	; 
                 .equ	DWDR4	= 4	; 
                 .equ	DWDR5	= 5	; 
                 .equ	DWDR6	= 6	; 
                 .equ	DWDR7	= 7	; 
                 
                 ; GPIOR2 - General Purpose IO register 2
                 .equ	GPIOR20	= 0	; 
                 .equ	GPIOR21	= 1	; 
                 .equ	GPIOR22	= 2	; 
                 .equ	GPIOR23	= 3	; 
                 .equ	GPIOR24	= 4	; 
                 .equ	GPIOR25	= 5	; 
                 .equ	GPIOR26	= 6	; 
                 .equ	GPIOR27	= 7	; 
                 
                 ; GPIOR1 - General Purpose register 1
                 .equ	GPIOR10	= 0	; 
                 .equ	GPIOR11	= 1	; 
                 .equ	GPIOR12	= 2	; 
                 .equ	GPIOR13	= 3	; 
                 .equ	GPIOR14	= 4	; 
                 .equ	GPIOR15	= 5	; 
                 .equ	GPIOR16	= 6	; 
                 .equ	GPIOR17	= 7	; 
                 
                 ; GPIOR0 - General purpose register 0
                 .equ	GPIOR00	= 0	; 
                 .equ	GPIOR01	= 1	; 
                 .equ	GPIOR02	= 2	; 
                 .equ	GPIOR03	= 3	; 
                 .equ	GPIOR04	= 4	; 
                 .equ	GPIOR05	= 5	; 
                 .equ	GPIOR06	= 6	; 
                 .equ	GPIOR07	= 7	; 
                 
                 
                 ; ***** BOOT_LOAD ********************
                 ; SPMCSR - Store Program Memory Control Register
                 .equ	SPMEN	= 0	; Store Program Memory Enable
                 .equ	PGERS	= 1	; Page Erase
                 .equ	PGWRT	= 2	; Page Write
                 .equ	RFLB	= 3	; Read fuse and lock bits
                 .equ	CTPB	= 4	; Clear temporary page buffer
                 
                 
                 
                 ; ***** LOCKSBITS ********************************************************
                 .equ	LB1	= 0	; Lockbit
                 .equ	LB2	= 1	; Lockbit
                 
                 
                 ; ***** FUSES ************************************************************
                 ; LOW fuse bits
                 .equ	CKSEL0	= 0	; Select Clock source
                 .equ	CKSEL1	= 1	; Select Clock source
                 .equ	CKSEL2	= 2	; Select Clock source
                 .equ	CKSEL3	= 3	; Select Clock source
                 .equ	SUT0	= 4	; Select start-up time
                 .equ	SUT1	= 5	; Select start-up time
                 .equ	CKOUT	= 6	; Clock Output Enable
                 .equ	CKDIV8	= 7	; Divide clock by 8
                 
                 ; HIGH fuse bits
                 .equ	BODLEVEL0	= 0	; Brown-out Detector trigger level
                 .equ	BODLEVEL1	= 1	; Brown-out Detector trigger level
                 .equ	BODLEVEL2	= 2	; Brown-out Detector trigger level
                 .equ	EESAVE	= 3	; EEPROM memory is preserved through the Chip Erase
                 .equ	WDTON	= 4	; Watchdog Timer always on
                 .equ	SPIEN	= 5	; Enable Serial Program and Data Downloading
                 .equ	DWEN	= 6	; DebugWIRE Enable
                 .equ	RSTDISBL	= 7	; External Reset disable
                 
                 ; EXTENDED fuse bits
                 .equ	SELFPRGEN	= 0	; Self-Programming Enable
                 
                 
                 
                 ; ***** CPU REGISTER DEFINITIONS *****************************************
                 .def	XH	= r27
                 .def	XL	= r26
                 .def	YH	= r29
                 .def	YL	= r28
                 .def	ZH	= r31
                 .def	ZL	= r30
                 
                 
                 
                 ; ***** DATA MEMORY DECLARATIONS *****************************************
                 .equ	FLASHEND	= 0x07ff	; Note: Word address
                 .equ	IOEND	= 0x003f
                 .equ	SRAM_START	= 0x0060
                 .equ	SRAM_SIZE	= 256
                 .equ	RAMEND	= 0x015f
                 .equ	XRAMEND	= 0x0000
                 .equ	E2END	= 0x00ff
                 .equ	EEPROMEND	= 0x00ff
                 .equ	EEADRBITS	= 8
                 #pragma AVRPART MEMORY PROG_FLASH 4096
                 #pragma AVRPART MEMORY EEPROM 256
                 #pragma AVRPART MEMORY INT_SRAM SIZE 256
                 #pragma AVRPART MEMORY INT_SRAM START_ADDR 0x60
                 
                 
                 
                 ; ***** BOOTLOADER DECLARATIONS ******************************************
                 .equ	NRWW_START_ADDR	= 0x0
                 .equ	NRWW_STOP_ADDR	= 0x7ff
                 .equ	RWW_START_ADDR	= 0x0
                 .equ	RWW_STOP_ADDR	= 0x0
                 .equ	PAGESIZE	= 32
                 
                 
                 
                 ; ***** INTERRUPT VECTORS ************************************************
                 .equ	INT0addr	= 0x0001	; External Interrupt 0
                 .equ	PCI0addr	= 0x0002	; Pin change Interrupt Request 0
                 .equ	OC1Aaddr	= 0x0003	; Timer/Counter1 Compare Match 1A
                 .equ	OVF1addr	= 0x0004	; Timer/Counter1 Overflow
                 .equ	OVF0addr	= 0x0005	; Timer/Counter0 Overflow
                 .equ	ERDYaddr	= 0x0006	; EEPROM Ready
                 .equ	ACIaddr	= 0x0007	; Analog comparator
                 .equ	ADCCaddr	= 0x0008	; ADC Conversion ready
                 .equ	OC1Baddr	= 0x0009	; Timer/Counter1 Compare Match B
                 .equ	OC0Aaddr	= 0x000a	; Timer/Counter0 Compare Match A
                 .equ	OC0Baddr	= 0x000b	; Timer/Counter0 Compare Match B
                 .equ	WDTaddr	= 0x000c	; Watchdog Time-out
                 .equ	USI_STARTaddr	= 0x000d	; USI START
                 .equ	USI_OVFaddr	= 0x000e	; USI Overflow
                 
                 .equ	INT_VECTORS_SIZE	= 15	; size in words
                 
                 #endif  /* _TN45DEF_INC_ */
                 
                 ; ***** END OF FILE ******************************************************
                 
                 
                 ;***** Created: 2011-02-09 12:04 ******* Source: ATtiny45.xml ************
                 ;*************************************************************************
                 ;* A P P L I C A T I O N   N O T E   F O R   T H E   A V R   F A M I L Y
                 ;* 
                 ;* Number            : AVR000
                 ;* File Name         : "tn45def.inc"
                 ;* Title             : Register/Bit Definitions for the ATtiny45
                 ;* Date              : 2011-02-09
                 ;* Version           : 2.35
                 ;* Support E-mail    : avr@atmel.com
                 ;* Target MCU        : ATtiny45
                 ;* 
                 ;* DESCRIPTION
                 ;* When including this file in the assembly program file, all I/O register 
                 ;* names and I/O register bit names appearing in the data book can be used.
                 ;* In addition, the six registers forming the three data pointers X, Y and 
                 ;* Z have been assigned names XL - ZH. Highest RAM address for Internal 
                 ;* SRAM is also defined 
                 ;* 
                 ;* The Register names are represented by their hexadecimal address.
                 ;* 
                 ;* The Register Bit names are represented by their bit number (0-7).
                 ;* 
                 ;* Please observe the difference in using the bit names with instructions
                 ;* such as "sbr"/"cbr" (set/clear bit in register) and "sbrs"/"sbrc"
                 ;* (skip if bit in register set/cleared). The following example illustrates
                 ;* this:
                 ;* 
                 ;* in    r16,PORTB             ;read PORTB latch
                 ;* sbr   r16,(1<<PB6)+(1<<PB5) ;set PB6 and PB5 (use masks, not bit#)
                 ;* out   PORTB,r16             ;output to PORTB
                 ;* 
                 ;* in    r16,TIFR              ;read the Timer Interrupt Flag Register
                 ;* sbrc  r16,TOV0              ;test the overflow flag (use bit#)
                 ;* rjmp  TOV0_is_set           ;jump if set
                 ;* ...                         ;otherwise do something else
                 ;*************************************************************************
                 
                 #ifndef _TN45DEF_INC_
                 #endif  /* _TN45DEF_INC_ */
                 
                 ; ***** END OF FILE ******************************************************
                 
                 .ORG 0x0000
                 ; global interrupt disable
000000 94f8      	cli
                 ; initialize stack
000001 e0f1      	ldi		r31,HIGH(RAMEND)
000002 bffe      	out		SPH,r31
000003 e5ff      	ldi		r31,LOW(RAMEND)
000004 bffd      	out		SPL,r31
                 
                 ; initialize trigger B1
000005 e003        	ldi		r16, 0b11	; portB,1 = output (triggers)
000006 bb07        	out		DDRB, r16
                 
000007 c3e5      	rjmp	main
                 
                 
                 ;******************* INCLUDE FILES *******************************
                 ; include encryption algorithm
                     .include "./LEDScenario1CBCDec.asm"
                 
                 .EQU    KEY2_NUM_BYTE = 8
                 .EQU    INITV_NUM_BYTE = 8
                 .EQU    PTEXT_NUM_BYTE = (8*16)
                 .EQU    KEYR_NUM_BYTE = 48
                 
                 #define KEYSCHEDULE
                 #define DECRYPT
                 
                 ; Registers declarations
                 ;303, 302, 301, 300 : 203, 202, 201, 200 : 103, 102, 101, 100 : 003, 002, 001, 000
                 ;313, 312, 311, 310 : 213, 212, 211, 210 : 113, 112, 111, 110 : 013, 012, 011, 010
                 ;323, 322, 321, 320 : 223, 222, 221, 220 : 123, 122, 121, 120 : 023, 022, 021, 020
                 ;333, 332, 331, 330 : 233, 232, 231, 230 : 133, 132, 131, 130 : 033, 032, 031, 030
                 ;
                 ;the 0-bit in the nibbles
                 ;s00: 300 200 100 000 : xxx xxx xxx xxx
                 ;s10: 310 210 110 010 : xxx xxx xxx xxx
                 ;s20: 320 220 120 020 : xxx xxx xxx xxx
                 ;s30: 330 230 130 030 : xxx xxx xxx xxx
                 ;the 1-bit in the nibbles
                 ;s01: 301 201 101 001 : xxx xxx xxx xxx
                 ;s11: 311 211 111 011 : xxx xxx xxx xxx
                 ;s21: 321 221 121 021 : xxx xxx xxx xxx
                 ;s31: 331 231 131 031 : xxx xxx xxx xxx
                 ;the 2-bit in the nibbles
                 ;s02: 302 202 102 002 : xxx xxx xxx xxx
                 ;s12: 312 212 112 012 : xxx xxx xxx xxx
                 ;s22: 322 222 122 022 : xxx xxx xxx xxx
                 ;s32: 332 232 132 032 : xxx xxx xxx xxx
                 ;the 3-bit in the nibbles
                 ;s03: 303 203 103 003 : xxx xxx xxx xxx
                 ;s13: 313 213 113 013 : xxx xxx xxx xxx
                 ;s23: 323 223 123 023 : xxx xxx xxx xxx
                 ;s33: 333 233 133 033 : xxx xxx xxx xxx
                 ;
                 ;s03:s02:s01:s00
                 ;s13:s12:s11:s10
                 ;s23:s22:s21:s20
                 ;s33:s32:s31:s30
                 ;
                 .def s00 =r0
                 .def s10 =r1
                 .def s20 =r2
                 .def s30 =r3
                 .def s01 =r4
                 .def s11 =r5
                 .def s21 =r6
                 .def s31 =r7
                 .def s02 =r8
                 .def s12 =r9
                 .def s22 =r10
                 .def s32 =r11
                 .def s03 =r12
                 .def s13 =r13
                 .def s23 =r14
                 .def s33 =r15
                 
                 .def t0 =r16
                 .def t1 =r17
                 .def t2 =r18
                 .def t3 =r19
                 .def t4 =r20
                 .def t5 =r21
                 .def t6 =r22
                 .def t7 =r23
                 
                 .def k0 =r16
                 .def k1 =r17
                 .def k2 =r18
                 .def k3 =r19
                 .def k4 =r20
                 .def k5 =r21
                 .def k6 =r22
                 .def k7 =r23
                 
                 .def m44 =r24 ; ldi m40, 0b01000100
                 .def m88 =r25 ; ldi m80, 0b10001000
                 
                 .def m0f =r24 ; ldi m40, 0b00001111
                 .def mf0 =r25 ; ldi m80, 0b11110000
                 
                 .def bn   =r26
                 .def bcnt =r27
                 
                 .def YL =r28
                 .def YH =r29
                 .def ZL =r30
                 .def ZH =r31
                 
                 .def tmp =r0
                 
                 ;;;****************************************************************************
                 ;;; Load input and Store output
                 ;;;****************************************************************************
                 ;;;
                 .MACRO Reorder1Byte
                 	ror @0
                 	ror @1
                 	ror @0
                 	ror @2
                 	ror @0
                 	ror @3
                 	ror @0
                 	ror @4
                 .ENDMACRO
                 
                 .MACRO Reorder1ByteOutput
                 	ror @1
                 	ror @0
                 	ror @2
                 	ror @0
                 	ror @3
                 	ror @0
                 	ror @4
                 	ror @0
                 .ENDMACRO
                 
                 ;.MACRO ReorderInput
                 ;	Reorder1Byte t1, s10, s11, s12, s13
                 ;	Reorder1Byte t3, s10, s11, s12, s13
                 ;	Reorder1Byte t5, s10, s11, s12, s13
                 ;	Reorder1Byte t7, s10, s11, s12, s13
                 ;
                 ;	Reorder1Byte t1, s00, s01, s02, s03
                 ;	Reorder1Byte t3, s00, s01, s02, s03
                 ;	Reorder1Byte t5, s00, s01, s02, s03
                 ;	Reorder1Byte t7, s00, s01, s02, s03
                 ;
                 ;	Reorder1Byte t0, s30, s31, s32, s33
                 ;	Reorder1Byte t2, s30, s31, s32, s33
                 ;	Reorder1Byte t4, s30, s31, s32, s33
                 ;	Reorder1Byte t6, s30, s31, s32, s33
                 ;
                 ;	Reorder1Byte t0, s20, s21, s22, s23
                 ;	Reorder1Byte t2, s20, s21, s22, s23
                 ;	Reorder1Byte t4, s20, s21, s22, s23
                 ;	Reorder1Byte t6, s20, s21, s22, s23
                 ;.ENDMACRO
                 ;
                 ;.MACRO ReorderOutput
                 ;	Reorder1ByteOutput t1, s10, s11, s12, s13
                 ;	Reorder1ByteOutput t3, s10, s11, s12, s13
                 ;	Reorder1ByteOutput t5, s10, s11, s12, s13
                 ;	Reorder1ByteOutput t7, s10, s11, s12, s13
                 ;
                 ;	Reorder1ByteOutput t1, s00, s01, s02, s03
                 ;	Reorder1ByteOutput t3, s00, s01, s02, s03
                 ;	Reorder1ByteOutput t5, s00, s01, s02, s03
                 ;	Reorder1ByteOutput t7, s00, s01, s02, s03
                 ;
                 ;	Reorder1ByteOutput t0, s30, s31, s32, s33
                 ;	Reorder1ByteOutput t2, s30, s31, s32, s33
                 ;	Reorder1ByteOutput t4, s30, s31, s32, s33
                 ;	Reorder1ByteOutput t6, s30, s31, s32, s33
                 ;
                 ;	Reorder1ByteOutput t0, s20, s21, s22, s23
                 ;	Reorder1ByteOutput t2, s20, s21, s22, s23
                 ;	Reorder1ByteOutput t4, s20, s21, s22, s23
                 ;	Reorder1ByteOutput t6, s20, s21, s22, s23
                 ;.ENDMACRO
                 ;
                 ;.MACRO loadReorderInput
                 ;	ldd  t0, Y+8
                 ;	ldd  t1, Y+9
                 ;	ldd  t2, Y+10
                 ;	ldd  t3, Y+11
                 ;	ldd  t4, Y+12
                 ;	ldd  t5, Y+13
                 ;	ldd  t6, Y+14
                 ;	ldd  t7, Y+15
                 ;	ReorderInput
                 ;.ENDMACRO
                 ;
                 ;.MACRO storeReorderOutput
                 ;	ReorderOutput
                 ;	ldd tmp, Y+0
                 ;	eor t0, tmp
                 ;	ldd tmp, Y+1
                 ;	eor t1, tmp
                 ;	ldd tmp, Y+2
                 ;	eor t2, tmp
                 ;	ldd tmp, Y+3
                 ;	eor t3, tmp
                 ;	ldd tmp, Y+4
                 ;	eor t4, tmp
                 ;	ldd tmp, Y+5
                 ;	eor t5, tmp
                 ;	ldd tmp, Y+6
                 ;	eor t6, tmp
                 ;	ldd tmp, Y+7
                 ;	eor t7, tmp
                 ;	st Y+, t0
                 ;	st Y+, t1
                 ;	st Y+, t2
                 ;	st Y+, t3
                 ;	st Y+, t4
                 ;	st Y+, t5
                 ;	st Y+, t6
                 ;	st Y+, t7
                 ;.ENDMACRO
                 
                 
                 ReorderInputSwitch:
000008 9517
000009 9497
00000a 9517
00000b 94d7
00000c 9517
00000d 9417
00000e 9517
00000f 9457      	Reorder1Byte t1, s12, s13, s10, s11
000010 9537
000011 9497
000012 9537
000013 94d7
000014 9537
000015 9417
000016 9537
000017 9457      	Reorder1Byte t3, s12, s13, s10, s11
000018 9557
000019 9497
00001a 9557
00001b 94d7
00001c 9557
00001d 9417
00001e 9557
00001f 9457      	Reorder1Byte t5, s12, s13, s10, s11
000020 9577
000021 9497
000022 9577
000023 94d7
000024 9577
000025 9417
000026 9577
000027 9457      	Reorder1Byte t7, s12, s13, s10, s11
                 
000028 9517
000029 9487
00002a 9517
00002b 94c7
00002c 9517
00002d 9407
00002e 9517
00002f 9447      	Reorder1Byte t1, s02, s03, s00, s01
000030 9537
000031 9487
000032 9537
000033 94c7
000034 9537
000035 9407
000036 9537
000037 9447      	Reorder1Byte t3, s02, s03, s00, s01
000038 9557
000039 9487
00003a 9557
00003b 94c7
00003c 9557
00003d 9407
00003e 9557
00003f 9447      	Reorder1Byte t5, s02, s03, s00, s01
000040 9577
000041 9487
000042 9577
000043 94c7
000044 9577
000045 9407
000046 9577
000047 9447      	Reorder1Byte t7, s02, s03, s00, s01
                 
000048 9507
000049 94b7
00004a 9507
00004b 94f7
00004c 9507
00004d 9437
00004e 9507
00004f 9477      	Reorder1Byte t0, s32, s33, s30, s31
000050 9527
000051 94b7
000052 9527
000053 94f7
000054 9527
000055 9437
000056 9527
000057 9477      	Reorder1Byte t2, s32, s33, s30, s31
000058 9547
000059 94b7
00005a 9547
00005b 94f7
00005c 9547
00005d 9437
00005e 9547
00005f 9477      	Reorder1Byte t4, s32, s33, s30, s31
000060 9567
000061 94b7
000062 9567
000063 94f7
000064 9567
000065 9437
000066 9567
000067 9477      	Reorder1Byte t6, s32, s33, s30, s31
                 
000068 9507
000069 94a7
00006a 9507
00006b 94e7
00006c 9507
00006d 9427
00006e 9507
00006f 9467      	Reorder1Byte t0, s22, s23, s20, s21
000070 9527
000071 94a7
000072 9527
000073 94e7
000074 9527
000075 9427
000076 9527
000077 9467      	Reorder1Byte t2, s22, s23, s20, s21
000078 9547
000079 94a7
00007a 9547
00007b 94e7
00007c 9547
00007d 9427
00007e 9547
00007f 9467      	Reorder1Byte t4, s22, s23, s20, s21
000080 9567
000081 94a7
000082 9567
000083 94e7
000084 9567
000085 9427
000086 9567
000087 9467      	Reorder1Byte t6, s22, s23, s20, s21
000088 9508      ret
                 
                 
                 ReorderOutputSwitch:
000089 9497
00008a 9517
00008b 94d7
00008c 9517
00008d 9417
00008e 9517
00008f 9457
000090 9517      	Reorder1ByteOutput t1, s12, s13, s10, s11
000091 9497
000092 9537
000093 94d7
000094 9537
000095 9417
000096 9537
000097 9457
000098 9537      	Reorder1ByteOutput t3, s12, s13, s10, s11
000099 9497
00009a 9557
00009b 94d7
00009c 9557
00009d 9417
00009e 9557
00009f 9457
0000a0 9557      	Reorder1ByteOutput t5, s12, s13, s10, s11
0000a1 9497
0000a2 9577
0000a3 94d7
0000a4 9577
0000a5 9417
0000a6 9577
0000a7 9457
0000a8 9577      	Reorder1ByteOutput t7, s12, s13, s10, s11
                 
0000a9 9487
0000aa 9517
0000ab 94c7
0000ac 9517
0000ad 9407
0000ae 9517
0000af 9447
0000b0 9517      	Reorder1ByteOutput t1, s02, s03, s00, s01
0000b1 9487
0000b2 9537
0000b3 94c7
0000b4 9537
0000b5 9407
0000b6 9537
0000b7 9447
0000b8 9537      	Reorder1ByteOutput t3, s02, s03, s00, s01
0000b9 9487
0000ba 9557
0000bb 94c7
0000bc 9557
0000bd 9407
0000be 9557
0000bf 9447
0000c0 9557      	Reorder1ByteOutput t5, s02, s03, s00, s01
0000c1 9487
0000c2 9577
0000c3 94c7
0000c4 9577
0000c5 9407
0000c6 9577
0000c7 9447
0000c8 9577      	Reorder1ByteOutput t7, s02, s03, s00, s01
                 
0000c9 94b7
0000ca 9507
0000cb 94f7
0000cc 9507
0000cd 9437
0000ce 9507
0000cf 9477
0000d0 9507      	Reorder1ByteOutput t0, s32, s33, s30, s31
0000d1 94b7
0000d2 9527
0000d3 94f7
0000d4 9527
0000d5 9437
0000d6 9527
0000d7 9477
0000d8 9527      	Reorder1ByteOutput t2, s32, s33, s30, s31
0000d9 94b7
0000da 9547
0000db 94f7
0000dc 9547
0000dd 9437
0000de 9547
0000df 9477
0000e0 9547      	Reorder1ByteOutput t4, s32, s33, s30, s31
0000e1 94b7
0000e2 9567
0000e3 94f7
0000e4 9567
0000e5 9437
0000e6 9567
0000e7 9477
0000e8 9567      	Reorder1ByteOutput t6, s32, s33, s30, s31
                 
0000e9 94a7
0000ea 9507
0000eb 94e7
0000ec 9507
0000ed 9427
0000ee 9507
0000ef 9467
0000f0 9507      	Reorder1ByteOutput t0, s22, s23, s20, s21
0000f1 94a7
0000f2 9527
0000f3 94e7
0000f4 9527
0000f5 9427
0000f6 9527
0000f7 9467
0000f8 9527      	Reorder1ByteOutput t2, s22, s23, s20, s21
0000f9 94a7
0000fa 9547
0000fb 94e7
0000fc 9547
0000fd 9427
0000fe 9547
0000ff 9467
000100 9547      	Reorder1ByteOutput t4, s22, s23, s20, s21
000101 94a7
000102 9567
000103 94e7
000104 9567
000105 9427
000106 9567
000107 9467
000108 9567      	Reorder1ByteOutput t6, s22, s23, s20, s21
000109 9508      ret
                 
                 
                 .MACRO loadRC
                 	ldi ZH, high(RC<<1)
                 	ldi ZL, low(RC<<1)
                 	ldi XH, high(SRAM_KTEXTR+KEYR_NUM_BYTE)
                 	ldi XL, low(SRAM_KTEXTR+KEYR_NUM_BYTE)
                 	ldi r18, KEYR_NUM_BYTE
                 loadRCloop:
                 	lpm r16, Z+
                 	st  -X,r16
                 	dec r18
                 	brbc 1, loadRCloop
                 .ENDMACRO
                 
                 .MACRO loadReorderInputSwitch
                 	ldd  t0, Y+8
                 	ldd  t1, Y+9
                 	ldd  t2, Y+10
                 	ldd  t3, Y+11
                 	ldd  t4, Y+12
                 	ldd  t5, Y+13
                 	ldd  t6, Y+14
                 	ldd  t7, Y+15
                 	rcall ReorderInputSwitch
                 	ldd  t0, Y+16
                 	ldd  t1, Y+17
                 	ldd  t2, Y+18
                 	ldd  t3, Y+19
                 	ldd  t4, Y+20
                 	ldd  t5, Y+21
                 	ldd  t6, Y+22
                 	ldd  t7, Y+23
                 	rcall ReorderInputSwitch
                 .ENDMACRO
                 
                 
                 .MACRO storeReorderOutputSwitch
                 	rcall ReorderOutputSwitch
                 	ldd tmp, Y+0
                 	eor t0, tmp
                 	ldd tmp, Y+1
                 	eor t1, tmp
                 	ldd tmp, Y+2
                 	eor t2, tmp
                 	ldd tmp, Y+3
                 	eor t3, tmp
                 	ldd tmp, Y+4
                 	eor t4, tmp
                 	ldd tmp, Y+5
                 	eor t5, tmp
                 	ldd tmp, Y+6
                 	eor t6, tmp
                 	ldd tmp, Y+7
                 	eor t7, tmp
                 	st Y+, t0
                 	st Y+, t1
                 	st Y+, t2
                 	st Y+, t3
                 	st Y+, t4
                 	st Y+, t5
                 	st Y+, t6
                 	st Y+, t7
                 	rcall ReorderOutputSwitch
                 	ldd tmp, Y+0
                 	eor t0, tmp
                 	ldd tmp, Y+1
                 	eor t1, tmp
                 	ldd tmp, Y+2
                 	eor t2, tmp
                 	ldd tmp, Y+3
                 	eor t3, tmp
                 	ldd tmp, Y+4
                 	eor t4, tmp
                 	ldd tmp, Y+5
                 	eor t5, tmp
                 	ldd tmp, Y+6
                 	eor t6, tmp
                 	ldd tmp, Y+7
                 	eor t7, tmp
                 	st  Y+, t0
                 	st  Y+, t1
                 	st  Y+, t2
                 	st  Y+, t3
                 	st  Y+, t4
                 	st  Y+, t5
                 	st  Y+, t6
                 	st  Y+, t7
                 .ENDMACRO
                 
                 ;;;****************************************************************************
                 ;;; KeySchedule
                 ;;;****************************************************************************
                 ;;;
                 .MACRO ExtendKey
                 	movw t0, @0
                 	swap t0
                 	swap t1
                 	and  t0, m0f
                 	and  t1, m0f
                 	and  @0, mf0
                 	and  @1, mf0
                 	or   @0, t0
                 	or   @1, t1
                 .ENDMACRO
                 
                 keySchedule:
00010a e0f0      	ldi ZH, high(SRAM_KTEXT1)
00010b e6e0      	ldi ZL, low(SRAM_KTEXT1)
00010c 8100      	ldd t0, Z+0
00010d 8111      	ldd t1, Z+1
00010e 8122      	ldd t2, Z+2
00010f 8133      	ldd t3, Z+3
000110 8144      	ldd t4, Z+4
000111 8155      	ldd t5, Z+5
000112 8166      	ldd t6, Z+6
000113 8177      	ldd t7, Z+7
000114 def3      	rcall ReorderInputSwitch
000115 0180
000116 9502
000117 9512
000118 2308
000119 2318
00011a 2209
00011b 2219
00011c 2a00
00011d 2a11      	ExtendKey s00, s10
00011e 0181
00011f 9502
000120 9512
000121 2308
000122 2318
000123 2229
000124 2239
000125 2a20
000126 2a31      	ExtendKey s20, s30
000127 0182
000128 9502
000129 9512
00012a 2308
00012b 2318
00012c 2249
00012d 2259
00012e 2a40
00012f 2a51      	ExtendKey s01, s11
000130 0183
000131 9502
000132 9512
000133 2308
000134 2318
000135 2269
000136 2279
000137 2a60
000138 2a71      	ExtendKey s21, s31
000139 0184
00013a 9502
00013b 9512
00013c 2308
00013d 2318
00013e 2289
00013f 2299
000140 2a80
000141 2a91      	ExtendKey s02, s12
000142 0185
000143 9502
000144 9512
000145 2308
000146 2318
000147 22a9
000148 22b9
000149 2aa0
00014a 2ab1      	ExtendKey s22, s32
00014b 0186
00014c 9502
00014d 9512
00014e 2308
00014f 2318
000150 22c9
000151 22d9
000152 2ac0
000153 2ad1      	ExtendKey s03, s13
000154 0187
000155 9502
000156 9512
000157 2308
000158 2318
000159 22e9
00015a 22f9
00015b 2ae0
00015c 2af1      	ExtendKey s23, s33
00015d 9201      	st Z+, s00
00015e 9211      	st Z+, s10
00015f 9221      	st Z+, s20
000160 9231      	st Z+, s30
000161 9241      	st Z+, s01
000162 9251      	st Z+, s11
000163 9261      	st Z+, s21
000164 9271      	st Z+, s31
000165 9281      	st Z+, s02
000166 9291      	st Z+, s12
000167 92a1      	st Z+, s22
000168 92b1      	st Z+, s32
000169 92c1      	st Z+, s03
00016a 92d1      	st Z+, s13
00016b 92e1      	st Z+, s23
00016c 92f1      	st Z+, s33
00016d e0f0      	ldi ZH, high(SRAM_KTEXT2)
00016e e6e8      	ldi ZL, low(SRAM_KTEXT2)
00016f 8100      	ldd t0, Z+0
000170 8111      	ldd t1, Z+1
000171 8122      	ldd t2, Z+2
000172 8133      	ldd t3, Z+3
000173 8144      	ldd t4, Z+4
000174 8155      	ldd t5, Z+5
000175 8166      	ldd t6, Z+6
000176 8177      	ldd t7, Z+7
000177 de90      	rcall ReorderInputSwitch
000178 0180
000179 9502
00017a 9512
00017b 2308
00017c 2318
00017d 2209
00017e 2219
00017f 2a00
000180 2a11      	ExtendKey s00, s10
000181 0181
000182 9502
000183 9512
000184 2308
000185 2318
000186 2229
000187 2239
000188 2a20
000189 2a31      	ExtendKey s20, s30
00018a 0182
00018b 9502
00018c 9512
00018d 2308
00018e 2318
00018f 2249
000190 2259
000191 2a40
000192 2a51      	ExtendKey s01, s11
000193 0183
000194 9502
000195 9512
000196 2308
000197 2318
000198 2269
000199 2279
00019a 2a60
00019b 2a71      	ExtendKey s21, s31
00019c 0184
00019d 9502
00019e 9512
00019f 2308
0001a0 2318
0001a1 2289
0001a2 2299
0001a3 2a80
0001a4 2a91      	ExtendKey s02, s12
0001a5 0185
0001a6 9502
0001a7 9512
0001a8 2308
0001a9 2318
0001aa 22a9
0001ab 22b9
0001ac 2aa0
0001ad 2ab1      	ExtendKey s22, s32
0001ae 0186
0001af 9502
0001b0 9512
0001b1 2308
0001b2 2318
0001b3 22c9
0001b4 22d9
0001b5 2ac0
0001b6 2ad1      	ExtendKey s03, s13
0001b7 0187
0001b8 9502
0001b9 9512
0001ba 2308
0001bb 2318
0001bc 22e9
0001bd 22f9
0001be 2ae0
0001bf 2af1      	ExtendKey s23, s33
0001c0 9201      	st Z+, s00
0001c1 9211      	st Z+, s10
0001c2 9221      	st Z+, s20
0001c3 9231      	st Z+, s30
0001c4 9241      	st Z+, s01
0001c5 9251      	st Z+, s11
0001c6 9261      	st Z+, s21
0001c7 9271      	st Z+, s31
0001c8 9281      	st Z+, s02
0001c9 9291      	st Z+, s12
0001ca 92a1      	st Z+, s22
0001cb 92b1      	st Z+, s32
0001cc 92c1      	st Z+, s03
0001cd 92d1      	st Z+, s13
0001ce 92e1      	st Z+, s23
0001cf 92f1      	st Z+, s33
0001d0 9508      ret
                 
                 
                 ;;;****************************************************************************
                 ;;; Components
                 ;;;****************************************************************************
                 ;;;
                 ;.MACRO iSboxInSwitch
                 ;	; a = s10:s00 = r1:r0
                 ;	; b = s11:s01 = r5:r4
                 ;	; c = s12:s02 = r9:r8
                 ;	; d = s13:s03 = r13:r12
                 ;	movw  t0, s01
                 ;	eor   t0, s03
                 ;	eor   t1, s13
                 ;	and  s03, s01
                 ;	and  s13, s11
                 ;	eor  s02, s03
                 ;	eor  s12, s13
                 ;	movw  t2, s02
                 ;	eor  s02, s00
                 ;	eor  s12, s10
                 ;	com  s02
                 ;	com  s12
                 ;	eor  s00, t0
                 ;	eor  s10, t1
                 ;	movw s03, s00
                 ;	and   t0, s02
                 ;	and   t1, s12
                 ;	eor  s01,  t0
                 ;	eor  s11,  t1
                 ;	movw  t0, s03
                 ;	eor  s00, s01
                 ;	eor  s10, s11
                 ;	and  s00,  t2
                 ;	and  s10,  t3
                 ;	eor  s03, s00
                 ;	eor  s13, s10
                 ;	eor  s00, s01
                 ;	eor  s10, s11
                 ;	com  s00
                 ;	com  s10
                 ;	or   s01,  t0
                 ;	or   s11,  t1
                 ;	eor  s01,  t2
                 ;	eor  s11,  t3
                 ;
                 ;	; a = s30:s20 = r1:r0
                 ;	; b = s31:s21 = r5:r4
                 ;	; c = s32:s22 = r9:r8
                 ;	; d = s33:s23 = r13:r12
                 ;	movw  t0, s21
                 ;	eor   t0, s23
                 ;	eor   t1, s33
                 ;	and  s23, s21
                 ;	and  s33, s31
                 ;	eor  s22, s23
                 ;	eor  s32, s33
                 ;	movw  t2, s22
                 ;	eor  s22, s20
                 ;	eor  s32, s30
                 ;	com  s22
                 ;	com  s32
                 ;	eor  s20, t0
                 ;	eor  s30, t1
                 ;	movw s23, s20
                 ;	and   t0, s22
                 ;	and   t1, s32
                 ;	eor  s21,  t0
                 ;	eor  s31,  t1
                 ;	movw  t0, s23
                 ;	eor  s20, s21
                 ;	eor  s30, s31
                 ;	and  s20,  t2
                 ;	and  s30,  t3
                 ;	eor  s23, s20
                 ;	eor  s33, s30
                 ;	eor  s20, s21
                 ;	eor  s30, s31
                 ;	com  s20
                 ;	com  s30
                 ;	or   s21,  t0
                 ;	or   s31,  t1
                 ;	eor  s21,  t2
                 ;	eor  s31,  t3
                 ;.ENDMACRO
                 
                 .MACRO iSboxSwitch
                 	; a = s10:s00 = r1:r0
                 	; b = s11:s01 = r5:r4
                 	; c = s12:s02 = r9:r8
                 	; d = s13:s03 = r13:r12
                 	movw  t0, s03
                 	eor   t0, s01
                 	eor   t1, s11
                 	and  s01, s03
                 	and  s11, s13
                 	eor  s00, s01
                 	eor  s10, s11
                 	movw  t2, s00
                 	eor  s00, s02
                 	eor  s10, s12
                 	com  s00
                 	com  s10
                 	eor  s02, t0
                 	eor  s12, t1
                 	movw s01, s02
                 	and   t0, s00
                 	and   t1, s10
                 	eor  s03,  t0
                 	eor  s13,  t1
                 	movw  t0, s01
                 	eor  s02, s03
                 	eor  s12, s13
                 	and  s02,  t2
                 	and  s12,  t3
                 	eor  s01, s02
                 	eor  s11, s12
                 	eor  s02, s03
                 	eor  s12, s13
                 	com  s02
                 	com  s12
                 	or   s03,  t0
                 	or   s13,  t1
                 	eor  s03,  t2
                 	eor  s13,  t3
                 
                 	; a = s30:s20 = r1:r0
                 	; b = s31:s21 = r5:r4
                 	; c = s32:s22 = r9:r8
                 	; d = s33:s23 = r13:r12
                 	movw  t0, s23
                 	eor   t0, s21
                 	eor   t1, s31
                 	and  s21, s23
                 	and  s31, s33
                 	eor  s20, s21
                 	eor  s30, s31
                 	movw  t2, s20
                 	eor  s20, s22
                 	eor  s30, s32
                 	com  s20
                 	com  s30
                 	eor  s22, t0
                 	eor  s32, t1
                 	movw s21, s22
                 	and   t0, s20
                 	and   t1, s30
                 	eor  s23,  t0
                 	eor  s33,  t1
                 	movw  t0, s21
                 	eor  s22, s23
                 	eor  s32, s33
                 	and  s22,  t2
                 	and  s32,  t3
                 	eor  s21, s22
                 	eor  s31, s32
                 	eor  s22, s23
                 	eor  s32, s33
                 	com  s22
                 	com  s32
                 	or   s23,  t0
                 	or   s33,  t1
                 	eor  s23,  t2
                 	eor  s33,  t3
                 .ENDMACRO
                 
                 
                 ;;;****************************************************************************
                 ;;; iMixColumn
                 .MACRO iMixColumn
                 	// A1
                 	eor  s02, s10
                 	eor  s02, s23
                 	eor  s02, s33
                 	eor  s03, s33
                 	eor  s03, s23
                 	eor  s03, s02
                 	eor  s03, s30
                 	eor  s03, s20
                 	eor  s03, s11
                 	eor  s00, s03
                 	eor  s00, s31
                 	eor  s00, s21
                 	eor  s00, s12
                 	eor  s01, s32
                 	eor  s01, s22
                 	eor  s01, s13
                 
                 	// A2
                 	eor  s12, s01
                 	eor  s12, s33
                 	eor  s12, s20
                 	eor  s13, s01
                 	eor  s13, s33
                 	eor  s13, s02
                 	eor  s13, s30
                 	eor  s13, s21
                 	eor  s13, s12
                 	eor  s10, s03
                 	eor  s10, s31
                 	eor  s10, s22
                 	eor  s10, s13
                 	eor  s11, s00
                 	eor  s11, s32
                 	eor  s11, s23
                 
                 	// A3
                 	eor  s22, s01
                 	eor  s22, s30
                 	eor  s22, s11
                 	eor  s23, s31
                 	eor  s23, s22
                 	eor  s23, s11
                 	eor  s23, s01
                 	eor  s23, s12
                 	eor  s23, s02
                 	eor  s20, s23
                 	eor  s20, s13
                 	eor  s20, s32
                 	eor  s20, s03
                 	eor  s21, s33
                 	eor  s21, s00
                 	eor  s21, s10
                 
                 	// A4
                 	eor  s32, s02
                 	eor  s32, s11
                 	eor  s32, s21
                 	eor  s33, s32
                 	eor  s33, s03
                 	eor  s33, s12
                 	eor  s33, s22
                 	eor  s33, s11
                 	eor  s33, s21
                 	eor  s30, s33
                 	eor  s30, s00
                 	eor  s30, s13
                 	eor  s30, s23
                 	eor  s31, s01
                 	eor  s31, s10
                 	eor  s31, s20
                 .ENDMACRO
                 
                 
                 ;.MACRO Switch
                 ;	movw  t0, s00
                 ;	movw s00, s02
                 ;	movw s02,  t0
                 ;
                 ;	movw  t0, s01
                 ;	movw s01, s03
                 ;	movw s03,  t0
                 ;
                 ;	movw  t0, s10
                 ;	movw s10, s12
                 ;	movw s12,  t0
                 ;
                 ;	movw  t0, s11
                 ;	movw s11, s13
                 ;	movw s13,  t0
                 ;
                 ;	movw  t0, s20
                 ;	movw s20, s22
                 ;	movw s22,  t0
                 ;
                 ;	movw  t0, s21
                 ;	movw s21, s23
                 ;	movw s23,  t0
                 ;
                 ;	movw  t0, s30
                 ;	movw s30, s32
                 ;	movw s32,  t0
                 ;
                 ;	movw  t0, s31
                 ;	movw s31, s33
                 ;	movw s33,  t0
                 ;.ENDMACRO
                 
                 
                 ;.MACRO KeyXorSwitch
                 ;	lds k0, @0 +  0;
                 ;	eor s02, k0
                 ;	lds k0, @0 +  1;
                 ;	eor s12, k0
                 ;	lds k0, @0 +  2;
                 ;	eor s22, k0
                 ;	lds k0, @0 +  3;
                 ;	eor s32, k0
                 ;	lds k0, @0 +  4;
                 ;	eor s03, k0
                 ;	lds k0, @0 +  5;
                 ;	eor s13, k0
                 ;	lds k0, @0 +  6;
                 ;	eor s23, k0
                 ;	lds k0, @0 +  7;
                 ;	eor s33, k0
                 ;	lds k0, @0 +  8;
                 ;	eor s00, k0
                 ;	lds k0, @0 +  9;
                 ;	eor s10, k0
                 ;	lds k0, @0 + 10;
                 ;	eor s20, k0
                 ;	lds k0, @0 + 11;
                 ;	eor s30, k0
                 ;	lds k0, @0 + 12;
                 ;	eor s01, k0
                 ;	lds k0, @0 + 13;
                 ;	eor s11, k0
                 ;	lds k0, @0 + 14;
                 ;	eor s21, k0
                 ;	lds k0, @0 + 15;
                 ;	eor s31, k0
                 ;.ENDMACRO
                 
                 .MACRO KeyXorSwitch
                 	lds k0, @0 +  0;
                 	eor s00, k0
                 	lds k0, @0 +  1;
                 	eor s10, k0
                 	lds k0, @0 +  2;
                 	eor s20, k0
                 	lds k0, @0 +  3;
                 	eor s30, k0
                 	lds k0, @0 +  4;
                 	eor s01, k0
                 	lds k0, @0 +  5;
                 	eor s11, k0
                 	lds k0, @0 +  6;
                 	eor s21, k0
                 	lds k0, @0 +  7;
                 	eor s31, k0
                 	lds k0, @0 +  8;
                 	eor s02, k0
                 	lds k0, @0 +  9;
                 	eor s12, k0
                 	lds k0, @0 + 10;
                 	eor s22, k0
                 	lds k0, @0 + 11;
                 	eor s32, k0
                 	lds k0, @0 + 12;
                 	eor s03, k0
                 	lds k0, @0 + 13;
                 	eor s13, k0
                 	lds k0, @0 + 14;
                 	eor s23, k0
                 	lds k0, @0 + 15;
                 	eor s33, k0
                 .ENDMACRO
                 
                 
                 .MACRO Key1XorSwitch
                 	KeyXorSwitch SRAM_KTEXT1
                 .ENDMACRO
                 
                 .MACRO Key2XorSwitch
                 	KeyXorSwitch SRAM_KTEXT2
                 .ENDMACRO
                 
                 ;0  0  0  0 ;  0 c5 c4 c3 ;  0  0  0  0 ;  0  0  0  0
                 ;0  0  0  1 ;  0 c2 c1 c0 ;  0  0  0  0 ;  0  0  0  0
                 ;0  0  1  0 ;  0 c5 c4 c3 ;  0  0  0  0 ;  0  0  0  0
                 ;0  0  1  1 ;  0 c2 c1 c0 ;  0  0  0  0 ;  0  0  0  0
                 ;
                 ;s00 ^  0 c3 0 0
                 ;s01 ^  0 c4 0 0
                 ;s02 ^  0 c5 0 0
                 ;
                 ;s10 ^  1 c0 0 0
                 ;s11 ^  0 c1 0 0
                 ;s12 ^  0 c2 0 0
                 ;
                 ;s20 ^  0 c3 0 0
                 ;s21 ^  1 c4 0 0
                 ;s22 ^  0 c5 0 0
                 ;
                 ;s30 ^  1 c0 0 0
                 ;s31 ^  1 c1 0 0
                 ;s32 ^  0 c2 0 0
                 ;
                 .MACRO RCXor
                 	lpm  k0, Z+
                 
                 	bst  k0, 5
                 	brtc rc5
                 	eor  s02, m44 ; 01000100
                 	eor  s22, m44 ; 01000100
                 rc5:
                 	bst  k0, 4
                 	brtc rc4
                 	eor  s01, m44 ; 01000100
                 	eor  s21, m44 ; 01000100
                 rc4:
                 	eor  s03, m88 ; 10001000
                 	eor  s21, m88 ; 10001000
                 
                 	bst  k0, 3
                 	brtc rc3
                 	eor  s00, m44 ; 01000100
                 	eor  s20, m44 ; 01000100
                 rc3:
                 	bst  k0, 2
                 	brtc rc2
                 	eor  s12, m44 ; 01000100
                 	eor  s32, m44 ; 01000100
                 rc2:
                 	bst  k0, 1
                 	brtc rc1
                 	eor  s11, m44 ; 01000100
                 	eor  s31, m44 ; 01000100
                 rc1:
                 	eor  s13, m88 ; 10001000
                 	eor  s31, m88 ; 10001000
                 
                 	bst  k0, 0
                 	brtc rc0
                 	eor  s10, m44 ; 01000100
                 	eor  s30, m44 ; 01000100
                 rc0:
                 	eor  s10, m88 ; 10001000
                 	eor  s30, m88 ; 10001000
                 .ENDMACRO
                 
                 
                 .MACRO RCXorSwitch
                 	lpm  k0, Z+
                 
                 	bst  k0, 5
                 	brtc rc5
                 	eor  s00, m44 ; 01000100
                 	eor  s20, m44 ; 01000100
                 rc5:
                 	bst  k0, 4
                 	brtc rc4
                 	eor  s03, m44 ; 01000100
                 	eor  s23, m44 ; 01000100
                 rc4:
                 	eor  s01, m88 ; 10001000
                 	eor  s23, m88 ; 10001000
                 
                 	bst  k0, 3
                 	brtc rc3
                 	eor  s02, m44 ; 01000100
                 	eor  s22, m44 ; 01000100
                 rc3:
                 	bst  k0, 2
                 	brtc rc2
                 	eor  s10, m44 ; 01000100
                 	eor  s30, m44 ; 01000100
                 rc2:
                 	bst  k0, 1
                 	brtc rc1
                 	eor  s13, m44 ; 01000100
                 	eor  s33, m44 ; 01000100
                 rc1:
                 	eor  s11, m88 ; 10001000
                 	eor  s33, m88 ; 10001000
                 
                 	bst  k0, 0
                 	brtc rc0
                 	eor  s12, m44 ; 01000100
                 	eor  s32, m44 ; 01000100
                 rc0:
                 	eor  s12, m88 ; 10001000
                 	eor  s32, m88 ; 10001000
                 .ENDMACRO
                 
                 .MACRO iSR_1bits
                 	mov  t1, @1
                 	movw t2, @2
                 
                 	lsl  @3
                 	bst  t3, 3
                 	bld  @3, 0
                 	bst  t3, 7
                 	bld  @3, 4
                 
                 	and @2, t4
                 	and t2, t5
                 	lsl  @2
                 	lsl  @2
                 	lsr  t2
                 	lsr  t2
                 	eor  @2, t2
                 
                 	lsr  @1
                 	bst  t1, 0
                 	bld  @1, 3
                 	bst  t1, 4
                 	bld  @1, 7
                 .ENDMACRO
                 
                 .MACRO iSR
                 	iSR_1bits s00, s10, s20, s30
                 	iSR_1bits s01, s11, s21, s31
                 	iSR_1bits s02, s12, s22, s32
                 	iSR_1bits s03, s13, s23, s33
                 .ENDMACRO
                 
                 
                 iRoundFunction:
0001d1 2481
0001d2 248e
0001d3 248f
0001d4 24cf
0001d5 24ce
0001d6 24c8
0001d7 24c3
0001d8 24c2
0001d9 24c5
0001da 240c
0001db 2407
0001dc 2406
0001dd 2409
0001de 244b
0001df 244a
0001e0 244d
0001e1 2494
0001e2 249f
0001e3 2492
0001e4 24d4
0001e5 24df
0001e6 24d8
0001e7 24d3
0001e8 24d6
0001e9 24d9
0001ea 241c
0001eb 2417
0001ec 241a
0001ed 241d
0001ee 2450
0001ef 245b
0001f0 245e
0001f1 24a4
0001f2 24a3
0001f3 24a5
0001f4 24e7
0001f5 24ea
0001f6 24e5
0001f7 24e4
0001f8 24e9
0001f9 24e8
0001fa 242e
0001fb 242d
0001fc 242b
0001fd 242c
0001fe 246f
0001ff 2460
000200 2461
000201 24b8
000202 24b5
000203 24b6
000204 24fb
000205 24fc
000206 24f9
000207 24fa
000208 24f5
000209 24f6
00020a 243f
00020b 2430
00020c 243d
00020d 243e
00020e 2474
00020f 2471
000210 2472      	iMixColumn
000211 2d11
000212 0191
000213 0c33
000214 fb33
000215 f830
000216 fb37
000217 f834
000218 2224
000219 2325
00021a 0c22
00021b 0c22
00021c 9526
00021d 9526
00021e 2622
00021f 9416
000220 fb10
000221 f813
000222 fb14
000223 f817
000224 2d15
000225 0193
000226 0c77
000227 fb33
000228 f870
000229 fb37
00022a f874
00022b 2264
00022c 2325
00022d 0c66
00022e 0c66
00022f 9526
000230 9526
000231 2662
000232 9456
000233 fb10
000234 f853
000235 fb14
000236 f857
000237 2d19
000238 0195
000239 0cbb
00023a fb33
00023b f8b0
00023c fb37
00023d f8b4
00023e 22a4
00023f 2325
000240 0caa
000241 0caa
000242 9526
000243 9526
000244 26a2
000245 9496
000246 fb10
000247 f893
000248 fb14
000249 f897
00024a 2d1d
00024b 0197
00024c 0cff
00024d fb33
00024e f8f0
00024f fb37
000250 f8f4
000251 22e4
000252 2325
000253 0cee
000254 0cee
000255 9526
000256 9526
000257 26e2
000258 94d6
000259 fb10
00025a f8d3
00025b fb14
00025c f8d7      	iSR
00025d 0186
00025e 2504
00025f 2515
000260 204c
000261 205d
000262 2404
000263 2415
000264 0190
000265 2408
000266 2419
000267 9400
000268 9410
000269 2680
00026a 2691
00026b 0124
00026c 2100
00026d 2111
00026e 26c0
00026f 26d1
000270 0182
000271 248c
000272 249d
000273 2282
000274 2293
000275 2448
000276 2459
000277 248c
000278 249d
000279 9480
00027a 9490
00027b 2ac0
00027c 2ad1
00027d 26c2
00027e 26d3
00027f 0187
000280 2506
000281 2517
000282 206e
000283 207f
000284 2426
000285 2437
000286 0191
000287 242a
000288 243b
000289 9420
00028a 9430
00028b 26a0
00028c 26b1
00028d 0135
00028e 2102
00028f 2113
000290 26e0
000291 26f1
000292 0183
000293 24ae
000294 24bf
000295 22a2
000296 22b3
000297 246a
000298 247b
000299 24ae
00029a 24bf
00029b 94a0
00029c 94b0
00029d 2ae0
00029e 2af1
00029f 26e2
0002a0 26f3      	iSboxSwitch
0002a1 9105
0002a2 fb05
0002a3 f416
0002a4 2608
0002a5 2628
0002a6 fb04
0002a7 f416
0002a8 26c8
0002a9 26e8
0002aa 2649
0002ab 26e9
0002ac fb03
0002ad f416
0002ae 2688
0002af 26a8
0002b0 fb02
0002b1 f416
0002b2 2618
0002b3 2638
0002b4 fb01
0002b5 f416
0002b6 26d8
0002b7 26f8
0002b8 2659
0002b9 26f9
0002ba fb00
0002bb f416
0002bc 2698
0002bd 26b8
0002be 2699
0002bf 26b9      	RCXorSwitch
0002c0 9508      ret
                 
                 iStep1:
0002c1 9100 0060
0002c3 2600
0002c4 9100 0061
0002c6 2610
0002c7 9100 0062
0002c9 2620
0002ca 9100 0063
0002cc 2630
0002cd 9100 0064
0002cf 2640
0002d0 9100 0065
0002d2 2650
0002d3 9100 0066
0002d5 2660
0002d6 9100 0067
0002d8 2670
0002d9 9100 0068
0002db 2680
0002dc 9100 0069
0002de 2690
0002df 9100 006a
0002e1 26a0
0002e2 9100 006b
0002e4 26b0
0002e5 9100 006c
0002e7 26c0
0002e8 9100 006d
0002ea 26d0
0002eb 9100 006e
0002ed 26e0
0002ee 9100 006f
0002f0 26f0      	Key1XorSwitch
0002f1 dedf      	rcall iRoundFunction
0002f2 dede      	rcall iRoundFunction
0002f3 dedd      	rcall iRoundFunction
0002f4 dedc      	rcall iRoundFunction
0002f5 9508      ret
                 
                 iStep2:
0002f6 9100 0068
0002f8 2600
0002f9 9100 0069
0002fb 2610
0002fc 9100 006a
0002fe 2620
0002ff 9100 006b
000301 2630
000302 9100 006c
000304 2640
000305 9100 006d
000307 2650
000308 9100 006e
00030a 2660
00030b 9100 006f
00030d 2670
00030e 9100 0070
000310 2680
000311 9100 0071
000313 2690
000314 9100 0072
000316 26a0
000317 9100 0073
000319 26b0
00031a 9100 0074
00031c 26c0
00031d 9100 0075
00031f 26d0
000320 9100 0076
000322 26e0
000323 9100 0077
000325 26f0      	Key2XorSwitch
000326 deaa      	rcall iRoundFunction
000327 dea9      	rcall iRoundFunction
000328 dea8      	rcall iRoundFunction
000329 dea7      	rcall iRoundFunction
00032a 9508      ret
                 
                 #ifdef DECRYPT
                 decrypt:
00032b e0f7
00032c e8e4
00032d e0b1
00032e e2a8
00032f e320
000330 9105
000331 930e
000332 952a
000333 f7e1      	loadRC
000334 e484      	ldi m44, 0b01000100
000335 e898      	ldi m88, 0b10001000
000336 e0d0      	ldi YH, high(SRAM_INITV)
000337 e7c0      	ldi YL, low(SRAM_INITV)
000338 e0a8      	ldi bn, 8
000339 27bb      	clr bcnt
                 CBC16_decrypt_start:
00033a 8508
00033b 8519
00033c 852a
00033d 853b
00033e 854c
00033f 855d
000340 856e
000341 857f
000342 dcc5
000343 8908
000344 8919
000345 892a
000346 893b
000347 894c
000348 895d
000349 896e
00034a 897f
00034b dcbc      	loadReorderInputSwitch
                 
00034c e0f0      	ldi ZH, high(SRAM_KTEXTR)
00034d efe8      	ldi ZL, low(SRAM_KTEXTR)
                 
00034e e343      	ldi  t4, 0b00110011
00034f ec5c      	ldi  t5, 0b11001100
                 
000350 df70      	rcall iStep1
000351 dfa4      	rcall iStep2
                 
000352 df6e      	rcall iStep1
000353 dfa2      	rcall iStep2
                 
000354 df6c      	rcall iStep1
000355 dfa0      	rcall iStep2
                 
000356 df6a      	rcall iStep1
000357 df9e      	rcall iStep2
                 
000358 df68      	rcall iStep1
000359 df9c      	rcall iStep2
                 
00035a df66      	rcall iStep1
00035b df9a      	rcall iStep2
                 
00035c 9100 0060
00035e 2600
00035f 9100 0061
000361 2610
000362 9100 0062
000364 2620
000365 9100 0063
000367 2630
000368 9100 0064
00036a 2640
00036b 9100 0065
00036d 2650
00036e 9100 0066
000370 2660
000371 9100 0067
000373 2670
000374 9100 0068
000376 2680
000377 9100 0069
000379 2690
00037a 9100 006a
00037c 26a0
00037d 9100 006b
00037f 26b0
000380 9100 006c
000382 26c0
000383 9100 006d
000385 26d0
000386 9100 006e
000388 26e0
000389 9100 006f
00038b 26f0      	Key1XorSwitch
00038c dcfc
00038d 8008
00038e 2500
00038f 8009
000390 2510
000391 800a
000392 2520
000393 800b
000394 2530
000395 800c
000396 2540
000397 800d
000398 2550
000399 800e
00039a 2560
00039b 800f
00039c 2570
00039d 9309
00039e 9319
00039f 9329
0003a0 9339
0003a1 9349
0003a2 9359
0003a3 9369
0003a4 9379
0003a5 dce3
0003a6 8008
0003a7 2500
0003a8 8009
0003a9 2510
0003aa 800a
0003ab 2520
0003ac 800b
0003ad 2530
0003ae 800c
0003af 2540
0003b0 800d
0003b1 2550
0003b2 800e
0003b3 2560
0003b4 800f
0003b5 2570
0003b6 9309
0003b7 9319
0003b8 9329
0003b9 9339
0003ba 9349
0003bb 9359
0003bc 9369
0003bd 9379      	storeReorderOutputSwitch
                 
0003be 95b3      	inc bcnt
0003bf 13ba      	cpse bcnt, bn
0003c0 cf79      	rjmp CBC16_decrypt_start
                 CBC16_decrypt_end:
0003c1 9508      ret
                 #endif
                 
                 RC:
                 ; 1-24
0003c2 0301
0003c3 0f07
0003c4 3e1f
0003c5 3b3d
0003c6 2f37
0003c7 3c1e
0003c8 3339
0003c9 0e27
0003ca 3a1d
0003cb 2b35
0003cc 2c16
0003cd 3018      .db 0x01,0x03,0x07,0x0F,0x1F,0x3E,0x3D,0x3B,0x37,0x2F,0x1E,0x3C,0x39,0x33,0x27,0x0E,0x1D,0x3A,0x35,0x2B,0x16,0x2C,0x18,0x30
                 ; 25-48
0003ce 0221
0003cf 0b05
0003d0 2e17
0003d1 381c
0003d2 2331
0003d3 0d06
0003d4 361b
0003d5 1a2d
0003d6 2934
0003d7 2412
0003d8 1108
0003d9 0422      .db 0x21,0x02,0x05,0x0B,0x17,0x2E,0x1C,0x38,0x31,0x23,0x06,0x0D,0x1B,0x36,0x2D,0x1A,0x34,0x29,0x12,0x24,0x08,0x11,0x22,0x04
                 
                 ; iRoundFunction:
                 ; iM
                 ; |
                 ; iSR
                 ; |
                 ; iSboxSwitch
                 ; |
                 ; RCXor
                 
                 ; iStep:
                 ; |
                 ; iRoundFunction
                 ; |
                 ; iRoundFunction
                 ; |
                 ; iRoundFunction
                 ; |
                 ; iRoundFunction
                 
                 
                 ; loadReorderInputSwitch
                 ; |                                            {
                 ; |                                             i = 1
                 ; Key1XorSwitch
                 ; |
                 ; iStep
                 ; |
                 ; Key2XorSwitch
                 ; |
                 ; iStep
                 ; |                                             i = 2
                 ; Key1XorSwitch
                 ; |
                 ; iStep
                 ; |
                 ; Key2XorSwitch
                 ; |
                 ; iStep
                 ; |                                             i = 3
                 ; Key1XorSwitch
                 ; |
                 ; iStep
                 ; |
                 ; Key2XorSwitch
                 ; |
                 ; iStep
                 ; |                                             i = 4
                 ; Key1XorSwitch
                 ; |
                 ; iStep
                 ; |
                 ; Key2XorSwitch
                 ; |
                 ; iStep
                 ; |                                             i = 5
                 ; Key1XorSwitch
                 ; |
                 ; iStep
                 ; |
                 ; Key2XorSwitch
                 ; |
                 ; iStepSwitch
                 ; |                                             i = 6
                 ; Key1XorSwitch
                 ; |
                 ; iStep
                 ; |
                 ; Key2XorSwitch
                 ; |
                 ; iStep
                 ; |                                             }
                 ; Key1XorSwitch
                 ; |
                 ; storeReorderOutputSwitch
                 
                 .CSEG
                 
                 ;******************** FUNCTIONS ***********************************
                 ; This function copy bytes from ROM location pointed by ZH:ZL to
                 ; SRAM location pointed by XH:XL
                 ;	Z must contain source address
                 ;	X must contain destination address
                 ;	r18 must contain the number of byte to copy
                 ;	r16 is used for internal computation
                 copy_word:
0003da 9105      	lpm		r16, Z+
0003db 930d      	st 		X+,r16
0003dc 952a      	dec		r18
0003dd f7e1      	brbc	1, copy_word
0003de 9508      	ret
                 ;*******************************************************************
                 
                 ;******************** Q ELEC FUNCTIONS (START) *********************
                 ; wait : ret + 0xFF * (5*nop + 1*dec + 1*brbc)
                 wait:
0003df ef0f      	ldi		r16, 0xFF	;r16=FF
                 w_loop:
0003e0 0000      	nop
0003e1 0000      	nop
0003e2 0000      	nop
0003e3 0000      	nop
0003e4 0000      	nop
0003e5 950a      	dec		r16			; r16=r16-1
0003e6 f7c9      	brbc	1,w_loop	; branch sur loop si Z=0, cs si r16 != 0
0003e7 9508      	ret					; return from subroutine
                 
                 
                 ; wait2 : r17 * wait (to be set inside) + some instructions
                 wait2:
0003e8 ef1f      	ldi		r17, 0xFF	;
                 w_loop2:
0003e9 dff5      	rcall	wait
0003ea 951a      	dec		r17			; r17=r17-1
0003eb f7e9      	brbc	1,w_loop2	; branch sur loop2 si Z=0, cs si r17 != 0
0003ec 9508      	ret					; return from subroutine
                 ;******************** Q ELEC FUNCTIONS (END) *********************
                 
                 
                 ;******************** MAIN (START) *******************************
                 main:
                 	;LOAD THE INITV FROM THE DB BELOW TO SRAM
0003ed e0f8      	ldi		ZH, high(init<<1)
0003ee e5e8      	ldi		ZL, low(init<<1)
0003ef e0b0      	ldi 	XH, high(SRAM_INITV)
0003f0 e7a0      	ldi 	XL, low(SRAM_INITV)
0003f1 e028      	ldi		r18, INITV_NUM_BYTE
0003f2 dfe7      	rcall	copy_word
                 	
                 	;LOAD THE PTEXT FROM THE DB BELOW TO SRAM
0003f3 e0f8      	ldi		ZH, high(text<<1)
0003f4 e6e0      	ldi		ZL, low(text<<1)
0003f5 e0b0      	ldi 	XH, high(SRAM_PTEXT)
0003f6 e7a8      	ldi 	XL, low(SRAM_PTEXT)
0003f7 e820      	ldi		r18, PTEXT_NUM_BYTE
0003f8 dfe1      	rcall	copy_word
                 
                 main_loop:
                 
                 	;LOAD THE KEY FROM THE DB BELOW TO SRAM
0003f9 e0f8      	ldi		ZH, high(key<<1)
0003fa eee0      	ldi		ZL, low(key<<1)
0003fb e0b0      	ldi 	XH, high(SRAM_KTEXT1)
0003fc e6a0      	ldi 	XL, low(SRAM_KTEXT1)
0003fd e028      	ldi		r18, KEY1_NUM_BYTE
0003fe dfdb      	rcall	copy_word
0003ff e0b0      	ldi 	XH, high(SRAM_KTEXT2)
000400 e6a8      	ldi 	XL, low(SRAM_KTEXT2)
000401 e028      	ldi		r18, KEY2_NUM_BYTE
000402 dfd7      	rcall	copy_word
                 
                 	; Initialize XH:XL with start address of ptext/key memory location
000403 e0b0      	ldi 	XH, high(SRAM_PTEXT)
000404 e7a8      	ldi 	XL, low(SRAM_PTEXT)
000405 9ac1      	sbi		PORTB,1		; portA,0 = high (trigger on port A0)
000406 0000      	nop
000407 0000      	nop
000408 0000      	nop
000409 0000      	nop
00040a 98c1       	cbi		PORTB,1		; portA,0 = low
00040b 0000      	nop
00040c 0000      	nop
00040d 0000      	nop
                 
                 #ifdef KEYSCHEDULE
00040e dcfb      	rcall keySchedule
                 #endif
00040f 0000      	nop
000410 0000      	nop
000411 0000      	nop
000412 0000      	nop
000413 0000      	nop
000414 0000      	nop
000415 0000      	nop
000416 0000      	nop
000417 0000      	nop
000418 0000      	nop
                 
                 
                 #ifdef ENCRYPT	
                 #endif
                 	
                 #ifdef DECRYPT
000419 df11      	rcall   decrypt      ; encryption routine
                 #endif
                 
00041a 0000      	nop
00041b 0000      	nop
00041c 0000      	nop
00041d 0000      	nop
00041e 0000      	nop
00041f 0000      	nop
000420 0000      	nop
000421 0000      	nop
000422 0000      	nop
000423 0000      	nop
                 
000424 9ac0      	sbi		PORTB,0		; portA,0 = high (trigger on port A0)
000425 0000      	nop
000426 0000      	nop
000427 0000      	nop
000428 0000      	nop
000429 98c0       	cbi		PORTB,0		; portA,0 = low
                 
                 	;make a pause
00042a dfbd      	rcall	wait2
00042b dfbc      	rcall	wait2
                 ;	rcall	wait2
                 ;	rcall	wait2
                 ;	rcall	wait2
                 
                 init:
00042c 0000
00042d 0000
00042e 0000
00042f 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
                 text:
000430 0000
000431 0000
000432 0000
000433 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000434 0000
000435 0000
000436 0000
000437 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000438 0000
000439 0000
00043a 0000
00043b 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
00043c 0000
00043d 0000
00043e 0000
00043f 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000440 0000
000441 0000
000442 0000
000443 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000444 0000
000445 0000
000446 0000
000447 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000448 0000
000449 0000
00044a 0000
00044b 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
00044c 0000
00044d 0000
00044e 0000
00044f 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000450 0000
000451 0000
000452 0000
000453 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000454 0000
000455 0000
000456 0000
000457 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000458 0000
000459 0000
00045a 0000
00045b 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
00045c 0000
00045d 0000
00045e 0000
00045f 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000460 0000
000461 0000
000462 0000
000463 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000464 0000
000465 0000
000466 0000
000467 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
000468 0000
000469 0000
00046a 0000
00046b 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
00046c 0000
00046d 0000
00046e 0000
00046f 0000      .db $00,$00,$00,$00,$00,$00,$00,$00
                 key:
000470 0000
000471 0000
000472 0000
000473 0000
000474 0000
000475 0000
000476 0000
000477 0000      .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
                 
                 .DSEG
                 ;.ORG 0x60
000060             SRAM_KTEXT1: .BYTE KEY1_NUM_BYTE
000068             SRAM_KTEXT2: .BYTE KEY2_NUM_BYTE
000070             SRAM_INITV: .BYTE INITV_NUM_BYTE
000078             SRAM_PTEXT: .BYTE PTEXT_NUM_BYTE
0000f8             SRAM_KTEXTR: .BYTE KEYR_NUM_BYTE
                 
                 ;******************** MAIN (END) *********************************
                 
                 


RESOURCE USE INFORMATION
------------------------

Notice:
The register and instruction counts are symbol table hit counts,
and hence implicitly used resources are not counted, eg, the
'lpm' instruction without operands implicitly uses r0 and z,
none of which are counted.

x,y,z are separate entities in the symbol table and are
counted separately from r26..r31 here.

.dseg memory usage only counts static data declared with .byte

"ATtiny45" register use summary:
r0 :  64 r1 :  33 r2 :  37 r3 :  32 r4 :  34 r5 :  34 r6 :  37 r7 :  30 
r8 :  35 r9 :  37 r10:  40 r11:  36 r12:  37 r13:  38 r14:  44 r15:  40 
r16: 213 r17:  96 r18:  57 r19:  36 r20:  29 r21:  29 r22:  24 r23:  24 
r24:  45 r25:  39 r26:   8 r27:   9 r28:   1 r29:   1 r30:   7 r31:  11 
x  :   2 y  :  48 z  :  51 
Registers used: 35 out of 35 (100.0%)

"ATtiny45" instruction use summary:
.lds  :   0 .sts  :   0 adc   :   0 add   :   0 adiw  :   0 and   :  84 
andi  :   0 asr   :   0 bclr  :   0 bld   :  16 brbc  :   4 brbs  :   0 
brcc  :   0 brcs  :   0 break :   0 breq  :   0 brge  :   0 brhc  :   0 
brhs  :   0 brid  :   0 brie  :   0 brlo  :   0 brlt  :   0 brmi  :   0 
brne  :   0 brpl  :   0 brsh  :   0 brtc  :   6 brts  :   0 brvc  :   0 
brvs  :   0 bset  :   0 bst   :  22 cbi   :   2 cbr   :   0 clc   :   0 
clh   :   0 cli   :   1 cln   :   0 clr   :   1 cls   :   0 clt   :   0 
clv   :   0 clz   :   0 com   :   8 cp    :   0 cpc   :   0 cpi   :   0 
cpse  :   1 dec   :   4 eor   : 186 icall :   0 ijmp  :   0 in    :   0 
inc   :   1 ld    :   0 ldd   :  48 ldi   :  43 lds   :  48 lpm   :   3 
lsl   :  12 lsr   :  12 mov   :   4 movw  :  28 neg   :   0 nop   :  36 
or    :  36 ori   :   0 out   :   3 pop   :   0 push  :   0 rcall :  35 
ret   :  10 reti  :   0 rjmp  :   2 rol   :   0 ror   : 256 sbc   :   0 
sbci  :   0 sbi   :   2 sbic  :   0 sbis  :   0 sbiw  :   0 sbr   :   0 
sbrc  :   0 sbrs  :   0 sec   :   0 seh   :   0 sei   :   0 sen   :   0 
ser   :   0 ses   :   0 set   :   0 sev   :   0 sez   :   0 sleep :   0 
spm   :   0 st    :  50 std   :   0 sts   :   0 sub   :   0 subi  :   0 
swap  :  32 tst   :   0 wdr   :   0 
Instructions used: 31 out of 105 (29.5%)

"ATtiny45" memory use summary [bytes]:
Segment   Begin    End      Code   Data   Used    Size   Use%
---------------------------------------------------------------
[.cseg] 0x000000 0x0008f0   2088    200   2288    4096  55.9%
[.dseg] 0x000060 0x000128      0    200    200     256  78.1%
[.eseg] 0x000000 0x000000      0      0      0     256   0.0%

Assembly complete, 0 errors, 21 warnings
